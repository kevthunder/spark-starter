!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Spark=t()}}(function(){return function(){return function t(e,r,i){function n(o,a){if(!r[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var p=r[o]={exports:{}};e[o][0].call(p.exports,function(t){return n(e[o][1][t]||t)},p,p.exports,t,e,r,i)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)n(i[o]);return n}}()({1:[function(t,e,r){var i,n;n=t("spark-properties").PropertiesManager,i=t("./Mixable"),e.exports=function(){class Element extends i{constructor(t){super(),this.initPropertiesManager(t),this.init(),this.propertiesManager.initWatchers()}initPropertiesManager(t){return this.propertiesManager=this.propertiesManager.useScope(this),this.propertiesManager.initProperties(),this.propertiesManager.createScopeGetterSetters(),"object"==typeof t&&this.propertiesManager.setPropertiesData(t),this}init(){return this}tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null==this._callbacks[t]&&(this._callbacks[t]=((...e)=>(this[t].apply(this,e),null)),this._callbacks[t].owner=this),this._callbacks[t]}destroy(){return this.propertiesManager.destroy()}getFinalProperties(){return["propertiesManager"]}extended(t){return t.propertiesManager?t.propertiesManager=t.propertiesManager.copyWith(this.propertiesManager.propertiesOptions):t.propertiesManager=this.propertiesManager}static property(t,e){return this.prototype.propertiesManager=this.prototype.propertiesManager.withProperty(t,e)}static properties(t){return this.prototype.propertiesManager=this.prototype.propertiesManager.copyWith(t)}}return Element.prototype.propertiesManager=new n,Element}.call(this)},{"./Mixable":5,"spark-properties":17}],2:[function(t,e,r){var i,n;n=t("spark-properties").watchers.PropertyWatcher,i=t("spark-properties").Invalidator,e.exports=class ActivablePropertyWatcher extends n{loadOptions(t){return super.loadOptions(t),this.active=t.active}shouldBind(){var t;return null==this.active||(null==this.invalidator&&(this.invalidator=new i(this,this.scope),this.invalidator.callback=(()=>this.checkBind())),this.invalidator.recycle(),t=this.active(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),t)}}},{"spark-properties":17}],3:[function(t,e,r){var i;i=t("spark-properties").Invalidator,e.exports=class Invalidated{constructor(t){null!=t&&this.loadOptions(t),null!=t&&t.initByLoader&&null!=t.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.callback=t.callback}init(){return this.update()}unknown(){return this.invalidator.validateUnknowns()}invalidate(){return this.update()}update(){return null==this.invalidator&&(this.invalidator=new i(this,this.scope)),this.invalidator.recycle(),this.handleUpdate(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),this}handleUpdate(t){return null!=this.scope?this.callback.call(this.scope,t):this.callback(t)}destroy(){if(this.invalidator)return this.invalidator.unbind()}}},{"spark-properties":17}],4:[function(t,e,r){var i;i=t("./Overrider"),e.exports=function(){class Loader extends i{constructor(){super(),this.initPreloaded()}initPreloaded(){var t;return t=this.preloaded,this.preloaded=[],this.load(t)}load(t){var e,r;return r=[],e=t.map(t=>{var e;return null==t.instance&&(t=Object.assign({loader:this},t),e=Loader.load(t),(t=Object.assign({instance:e},t)).initByLoader&&null!=e.init&&r.push(e)),t}),this.preloaded=this.preloaded.concat(e),r.forEach(function(t){return t.init()})}preload(t){return Array.isArray(t)||(t=[t]),this.preloaded=(this.preloaded||[]).concat(t)}destroyLoaded(){return this.preloaded.forEach(function(t){var e;return null!=(e=t.instance)&&"function"==typeof e.destroy?e.destroy():void 0})}getFinalProperties(){return super.getFinalProperties().concat(["preloaded"])}extended(t){if(super.extended(t),this.preloaded)return t.preloaded=(t.preloaded||[]).concat(this.preloaded)}static loadMany(t){return t.map(t=>this.load(t))}static load(t){return"function"==typeof t.type.copyWith?t.type.copyWith(t):new t.type(t)}static preload(t){return this.prototype.preload(t)}}return Loader.prototype.preloaded=[],Loader.overrides({init:function(){return this.init.withoutLoader(),this.initPreloaded()},destroy:function(){return this.destroy.withoutLoader(),this.destroyLoaded()}}),Loader}.call(this)},{"./Overrider":6}],5:[function(t,e,r){var i=[].indexOf;e.exports=function(){class Mixable{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return Mixable.Extension={makeOnce:function(t,e){var r;if(!(null!=(r=e.extensions)?r.includes(t):void 0))return this.make(t,e)},make:function(t,e){var r,i,n,s,o;for(r=0,i=(o=this.getExtensionProperties(t,e)).length;r<i;r++)s=o[r],Object.defineProperty(e,s.name,s);if(t.getFinalProperties&&e.getFinalProperties?(n=e.getFinalProperties,e.getFinalProperties=function(){return t.getFinalProperties().concat(n.call(this))}):e.getFinalProperties=t.getFinalProperties||e.getFinalProperties,e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor","getFinalProperties"],getExtensionProperties:function(t,e){var r,n,s;return r=this.alwaysFinal,s=this.getPrototypeChain(e),n=[],this.getPrototypeChain(t).every(function(o){var a;if(!s.includes(o))return a=r,null!=t.getFinalProperties&&(a=a.concat(t.getFinalProperties())),"function"==typeof o&&(a=a.concat(["length","prototype","name"])),n=n.concat(Object.getOwnPropertyNames(o).filter(t=>!e.hasOwnProperty(t)&&"__"!==t.substr(0,2)&&i.call(a,t)<0&&!n.find(function(e){return e.name===t})).map(function(t){var e;return(e=Object.getOwnPropertyDescriptor(o,t)).name=t,e})),!0}),n},getPrototypeChain:function(t){var e,r;for(r=[],e=Object.getPrototypeOf(Object);r.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return r}},Mixable}.call(this)},{}],6:[function(t,e,r){e.exports=function(){class Overrider{static overrides(t){return this.Override.applyMany(this.prototype,this.name,t)}getFinalProperties(){return null!=this._overrides?["_overrides"].concat(Object.keys(this._overrides)):[]}extended(t){if(null!=this._overrides&&this.constructor.Override.applyMany(t,this.constructor.name,this._overrides),this.constructor===Overrider)return t.extended=this.extended}}return Overrider.Override={makeMany:function(t,e,r){var i,n,s;for(n in s=[],r)i=r[n],s.push(this.make(t,e,n,i));return s},applyMany:function(t,e,r){var i,n,s;for(i in s=[],r)"function"==typeof(n=r[i])&&(n=this.make(t,e,i,n)),s.push(this.apply(t,e,n));return s},make:function(t,e,r,i){var n;return(n={fn:{current:i},name:r}).fn["with"+e]=i,n},emptyFn:function(){},apply:function(t,e,r){var i,n,s,o,a;return i=r.name,n=null!=t._overrides?Object.assign({},t._overrides):{},a=(null!=(s=t._overrides)&&null!=(o=s[i])?o.fn.current:void 0)||t[i],r=Object.assign({},r),null!=n[i]?r.fn=Object.assign({},n[i].fn,r.fn):r.fn=Object.assign({},r.fn),r.fn["without"+e]=a||this.emptyFn,null==a?r.missingWithout="without"+e:r.missingWithout&&(r.fn[r.missingWithout]=a),Object.defineProperty(t,i,{configurable:!0,get:function(){var t,e,n,s;for(n in t=r.fn.current.bind(this),s=r.fn)e=s[n],t[n]=e.bind(this);return this.constructor.prototype!==this&&Object.defineProperty(this,i,{value:t}),t}}),n[i]=r,t._overrides=n}},Overrider}.call(this)},{}],7:[function(t,e,r){var i,n;i=t("spark-binding").Binder,e.exports=n=class Updater{constructor(t){var e;this.callbacks=[],this.next=[],this.updating=!1,null!=(null!=t?t.callback:void 0)&&this.addCallback(t.callback),null!=(null!=t&&null!=(e=t.callbacks)?e.forEach:void 0)&&t.callbacks.forEach(t=>this.addCallback(t))}update(){var t;for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)t=this.callbacks.shift(),this.runCallback(t);return this.callbacks=this.next,this.updating=!1,this}runCallback(t){return t()}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new Updater.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}},n.Binder=function(t){return class Binder extends t{constructor(t,e){super(),this.target=t,this.callback=e}getRef(){return{target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,i)},{"spark-binding":11}],8:[function(t,e,r){e.exports={Element:t("./Element"),Loader:t("./Loader"),Mixable:t("./Mixable"),Overrider:t("./Overrider"),Updater:t("./Updater"),Invalidated:{ActivablePropertyWatcher:t("./Invalidated/ActivablePropertyWatcher"),Invalidated:t("./Invalidated/Invalidated")}}},{"./Element":1,"./Invalidated/ActivablePropertyWatcher":2,"./Invalidated/Invalidated":3,"./Loader":4,"./Mixable":5,"./Overrider":6,"./Updater":7}],9:[function(t,e,r){var i;i=t("./libs"),e.exports=Object.assign({Collection:t("spark-collection")},i,t("spark-properties"),t("spark-binding"))},{"./libs":8,"spark-binding":11,"spark-collection":15,"spark-properties":17}],10:[function(t,e,r){var i=Object.create||function(t){var e=function(){};return e.prototype=t,new e},n=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return r},s=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function o(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=i(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0;var a,l=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),a=0===c.x}catch(t){a=!1}function p(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function h(t,e,r,n){var s,o,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),a=o[e]):(o=t._events=i(null),t._eventsCount=0),a){if("function"==typeof a?a=o[e]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),!a.warned&&(s=p(t))&&s>0&&a.length>s){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",l.name,l.message)}}else a=o[e]=r,++t._eventsCount;return t}function u(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function d(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=s.call(u,i);return n.listener=r,i.wrapFn=n,n}function f(t,e,r){var i=t._events;if(!i)return[];var n=i[e];return n?"function"==typeof n?r?[n.listener||n]:[n]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(n):y(n,n.length):[]}function v(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function y(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}a?Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');l=t}}):o.defaultMaxListeners=l,o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return p(this)},o.prototype.emit=function(t){var e,r,i,n,s,o,a="error"===t;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(a){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var l=new Error('Unhandled "error" event. ('+e+")");throw l.context=e,l}if(!(r=o[t]))return!1;var c="function"==typeof r;switch(i=arguments.length){case 1:!function(t,e,r){if(e)t.call(r);else for(var i=t.length,n=y(t,i),s=0;s<i;++s)n[s].call(r)}(r,c,this);break;case 2:!function(t,e,r,i){if(e)t.call(r,i);else for(var n=t.length,s=y(t,n),o=0;o<n;++o)s[o].call(r,i)}(r,c,this,arguments[1]);break;case 3:!function(t,e,r,i,n){if(e)t.call(r,i,n);else for(var s=t.length,o=y(t,s),a=0;a<s;++a)o[a].call(r,i,n)}(r,c,this,arguments[1],arguments[2]);break;case 4:!function(t,e,r,i,n,s){if(e)t.call(r,i,n,s);else for(var o=t.length,a=y(t,o),l=0;l<o;++l)a[l].call(r,i,n,s)}(r,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),s=1;s<i;s++)n[s-1]=arguments[s];!function(t,e,r,i){if(e)t.apply(r,i);else for(var n=t.length,s=y(t,n),o=0;o<n;++o)s[o].apply(r,i)}(r,c,this,n)}return!0},o.prototype.addListener=function(t,e){return h(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return h(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,d(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,d(this,t,e)),this},o.prototype.removeListener=function(t,e){var r,n,s,o,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=i(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){a=r[o].listener,s=o;break}if(s<0)return this;0===s?r.shift():function(t,e){for(var r=e,i=r+1,n=t.length;i<n;r+=1,i+=1)t[r]=t[i];t.pop()}(r,s),1===r.length&&(n[t]=r[0]),n.removeListener&&this.emit("removeListener",t,a||e)}return this},o.prototype.removeAllListeners=function(t){var e,r,s;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=i(null),this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=i(null):delete r[t]),this;if(0===arguments.length){var o,a=n(r);for(s=0;s<a.length;++s)"removeListener"!==(o=a[s])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=i(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this},o.prototype.listeners=function(t){return f(this,t,!0)},o.prototype.rawListeners=function(t){return f(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):v.call(t,e)},o.prototype.listenerCount=v,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],11:[function(t,e,r){e.exports={Binder:t("./src/Binder"),EventBind:t("./src/EventBind"),Reference:t("./src/Reference")}},{"./src/Binder":12,"./src/EventBind":13,"./src/Reference":14}],12:[function(t,e,r){e.exports=class Binder{toggleBind(t=!this.binded){return t?this.bind():this.unbind()}bind(){return!this.binded&&this.canBind()&&this.doBind(),this.binded=!0,this}canBind(){return!0}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&this.canBind()&&this.doUnbind(),this.binded=!1,this}doUnbind(){throw new Error("Not implemented")}destroy(){this.unbind()}}},{}],13:[function(t,e,r){const i=t("./Binder"),n=t("./Reference");e.exports=class EventBind extends i{constructor(t,e,r){super(),this.event=t,this.target=e,this.callback=r}canBind(){return null!=this.callback&&null!=this.target}bindTo(t){return this.unbind(),this.target=t,this.bind()}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return null!=t&&t.constructor===this.constructor&&t.event===this.event&&n.compareVal(t.target,this.target)&&n.compareVal(t.callback,this.callback)}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}},{"./Binder":12,"./Reference":14}],14:[function(t,e,r){class Reference{constructor(t){this.data=t}equals(t){return null!=t&&t.constructor===this.constructor&&this.compareData(t.data)}compareData(t){return t instanceof Reference?this.equals(t):this.data===t||null!=this.data&&null!=t&&("object"==typeof this.data&&"object"==typeof t?Object.keys(this.data).length===Object.keys(t).length&&Object.keys(t).every(e=>Reference.compareVal(this.data[e],t[e])):Reference.compareVal(this.data,t))}static compareVal(t,e){return t===e||null!=t&&null!=e&&("function"==typeof t.equals?t.equals(e):"function"==typeof e.equals?e.equals(t):!(!Array.isArray(t)||!Array.isArray(e))&&(t.length===e.length&&t.every((t,r)=>this.compareVal(t,e[r]))))}static makeReferred(t,e){return t.ref=e instanceof Reference?e:new Reference(e),t.equals=function(t){return null!=t&&this.ref.equals(t.ref)},t}}e.exports=Reference},{}],15:[function(t,e,r){e.exports=t("./src/Collection")},{"./src/Collection":16}],16:[function(t,e,r){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,r=null){return null==r&&(r=function(t,e){return t===e}),t=null!=t?this.copy(t.slice()):[],this.count()!==t.length||(e?this.some(function(e,i){return!r(t.get(i),e)}):this.some(function(e){return!t.pluck(function(t){return r(e,t)})}))}get(t){return this._array[t]}getRandom(){return this._array[Math.floor(Math.random()*this._array.length)]}set(t,e){var r;return this._array[t]!==e&&(r=this.toArray(),this._array[t]=e,this.changed(r)),e}add(t){return this._array.includes(t)?this:this.push(t)}remove(t){var e,r;return-1!==(e=this._array.indexOf(t))&&(r=this.toArray(),this._array.splice(e,1),this.changed(r)),this}pluck(t){var e,r,i;return(r=this._array.findIndex(t))>-1?(i=this.toArray(),e=this._array[r],this._array.splice(r,1),this.changed(i),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var r;return"object"==typeof t?(r=class extends(this){},Object.assign(r.prototype,t),new r(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,r){return t[r]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["concat","filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){Collection.prototype[t]=function(...e){var r,i;return r=this.toArray(),i=this._array[t](...e),this.changed(r),i}}),Object.defineProperty(Collection.prototype,"length",{get:function(){return this.count()}}),"undefined"!=typeof Symbol&&null!==Symbol&&Symbol.iterator&&(Collection.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()}),e.exports=Collection},{}],17:[function(t,e,r){e.exports={Invalidator:t("./src/Invalidator"),PropertiesManager:t("./src/PropertiesManager"),Property:t("./src/Property"),setters:{BaseSetter:t("./src/setters/BaseSetter"),BaseValueSetter:t("./src/setters/BaseValueSetter"),CollectionSetter:t("./src/setters/CollectionSetter"),ManualSetter:t("./src/setters/ManualSetter"),SimpleSetter:t("./src/setters/SimpleSetter")},watchers:{CollectionPropertyWatcher:t("./src/watchers/CollectionPropertyWatcher"),PropertyWatcher:t("./src/watchers/PropertyWatcher")},getters:{BaseGetter:t("./src/getters/BaseGetter"),CalculatedGetter:t("./src/getters/CalculatedGetter"),CompositeGetter:t("./src/getters/CompositeGetter"),InvalidatedGetter:t("./src/getters/InvalidatedGetter"),ManualGetter:t("./src/getters/ManualGetter"),SimpleGetter:t("./src/getters/SimpleGetter")}}},{"./src/Invalidator":18,"./src/PropertiesManager":19,"./src/Property":20,"./src/getters/BaseGetter":21,"./src/getters/CalculatedGetter":22,"./src/getters/CompositeGetter":23,"./src/getters/InvalidatedGetter":24,"./src/getters/ManualGetter":25,"./src/getters/SimpleGetter":26,"./src/setters/BaseSetter":27,"./src/setters/BaseValueSetter":28,"./src/setters/CollectionSetter":29,"./src/setters/ManualSetter":30,"./src/setters/SimpleSetter":31,"./src/watchers/CollectionPropertyWatcher":32,"./src/watchers/PropertyWatcher":33}],18:[function(t,e,r){const i=t("spark-binding").Binder,n=t("spark-binding").EventBind,s=function(t,e){var r,i;return(i=t.findIndex(e))>-1?(r=t[i],t.splice(i,1),r):null};class Invalidator extends i{constructor(t,e=null){super(),this.invalidated=t,this.scope=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalid=!1,this.invalidateCallback=(()=>{this.invalidate()}),this.invalidateCallback.owner=this,this.changedCallback=((t,e)=>{this.invalidate(e)}),this.changedCallback.owner=this}invalidate(t){var e;return this.invalid=!0,"function"==typeof this.invalidated?this.invalidated(t):"function"==typeof this.callback?this.callback(t):null!=this.invalidated&&"function"==typeof this.invalidated.invalidate?this.invalidated.invalidate(t):"string"==typeof this.invalidated&&(e="invalidate"+this.invalidated.charAt(0).toUpperCase()+this.invalidated.slice(1),"function"==typeof this.scope[e]?this.scope[e](t):this.scope[this.invalidated]=null),this}unknown(t){return null!=this.invalidated&&"function"==typeof this.invalidated.unknown?this.invalidated.unknown(t):this.invalidate(t)}addEventBind(t,e,r){return this.addBinder(new n(t,e,r))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(s(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t){var e;return(e=(e=>this.addUnknown(function(){return t.get()},t,e))).prop=t,e}addUnknown(t,e,r){if(!this.findUnknown(e))return t.prop=e,this.unknowns.push(t),this.unknown(r)}findUnknown(t){if(null!=t)return this.unknowns.find(function(e){return e.prop===t})}event(t,e=this.scope){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,r=this.scope){return this.event(e,r),t}prop(t){if(null!=t)return this.addEventBind("invalidated",t.events,this.getUnknownCallback(t)),this.addEventBind("updated",t.events,this.changedCallback),t.get()}propByName(t,e=this.scope){if(null!=e.propertiesManager){const r=e.propertiesManager.getProperty(t);if(r)return this.prop(r)}return null!=e[t+"Property"]?this.prop(e[t+"Property"]):e[t]}propPath(t,e=this.scope){var r,i;for(t=t.split("."),i=e;null!=i&&t.length>0;)r=t.shift(),i=this.propByName(r,i);return i}funct(t){var e,r;return e=new Invalidator(()=>this.addUnknown(()=>{var i;if(i=t(e),r!==i)return this.invalidate()},e)),r=t(e),this.invalidationEvents.push(e),r}validateUnknowns(){var t;return t=this.unknowns,this.unknowns=[],t.forEach(function(t){return t()})}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalid=!1,this.invalidationEvents.forEach(function(t){t.bind()}),this}recycle(t){var e,r;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=this.endRecycle.bind(this),"function"==typeof t?t.length>1?t(this,e):(r=t(this),e(),r):e}endRecycle(){return this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[],this}checkEmitter(t){return n.checkEmitter(t,this.strict)}checkPropInstance(t){return"function"==typeof t.get&&this.checkEmitter(t.events)}unbind(){return this.invalidationEvents.forEach(function(t){t.unbind()}),this}}Invalidator.strict=!0,e.exports=Invalidator},{"spark-binding":11}],19:[function(t,e,r){const i=t("./Property");e.exports=class PropertiesManager{constructor(t={},e={}){this.properties=[],this.globalOptions=Object.assign({initWatchers:!1},e),this.propertiesOptions=Object.assign({},t)}copyWith(t={},e={}){return new this.constructor(this.mergePropertiesOptions(this.propertiesOptions,t),Object.assign({},this.globalOptions,e))}withProperty(t,e){const r={};return r[t]=e,this.copyWith(r)}useScope(t){return this.copyWith({},{scope:t})}mergePropertiesOptions(...t){return t.reduce((t,e)=>(Object.keys(e).forEach(r=>{t[r]=this.mergePropertyOptions(t[r]||{},e[r])}),t),{})}mergePropertyOptions(...t){const e=["default","scope"];return t.reduce((t,r)=>(Object.keys(r).forEach(i=>{"function"!=typeof t[i]||"function"!=typeof r[i]||e.includes(i)?t[i]=r[i]:t[i]=this.mergeCallback(t[i],r[i])}),t),{})}mergeCallback(t,e){const r=function(...r){return e.call(this,...r,t.bind(this))};return r.components=(t.components||[t]).concat(t.newFunct||[e]),r.nbParams=e.nbParams||e.length,r}initProperties(){return this.addProperties(this.propertiesOptions),this}createScopeGetterSetters(){return this.properties.forEach(t=>t.createScopeGetterSetters()),this}initWatchers(){return this.properties.forEach(t=>t.initWatchers()),this}initScope(){return this.initProperties(),this.createScopeGetterSetters(),this.initWatchers(),this}addProperty(t,e){const r=new i(Object.assign({name:t},this.globalOptions,e));return this.properties.push(r),this}addProperties(t){return Object.keys(t).forEach(e=>this.addProperty(e,t[e])),this}getProperty(t){return this.properties.find(e=>e.options.name===t)}setPropertiesData(t,e={}){return Object.keys(t).forEach(r=>{if(!(null!=e.whitelist&&-1===e.whitelist.indexOf(r)||null!=e.blacklist&&-1!==e.blacklist.indexOf(r))){const e=this.getProperty(r);e&&e.set(t[r])}}),this}getManualDataProperties(){return this.properties.reduce((t,e)=>(e.getter.calculated&&e.manual&&(t[e.options.name]=e.get()),t),{})}destroy(){this.properties.forEach(t=>t.destroy())}}},{"./Property":20}],20:[function(t,e,r){const i=t("events").EventEmitter,n=t("./getters/SimpleGetter"),s=t("./getters/CalculatedGetter"),o=t("./getters/InvalidatedGetter"),a=t("./getters/ManualGetter"),l=t("./getters/CompositeGetter"),c=t("./setters/ManualSetter"),p=t("./setters/SimpleSetter"),h=t("./setters/BaseValueSetter"),u=t("./setters/CollectionSetter");class Property{constructor(t={}){this.options=Object.assign({},Property.defaultOptions,t),this.init()}init(){this.events=new this.options.EventEmitterClass,this.makeSetter(),this.makeGetter(),this.setter.init(),this.getter.init(),this.options.initWatchers&&this.initWatchers()}initWatchers(){this.setter.loadInternalWatcher()}makeGetter(){"function"==typeof this.options.get?this.getter=new a(this):null!=this.options.composed&&!1!==this.options.composed?this.getter=new l(this):"function"==typeof this.options.calcul?0===(this.options.calcul.nbParams||this.options.calcul.length)?this.getter=new s(this):this.getter=new o(this):this.getter=new n(this)}makeSetter(){"function"==typeof this.options.set?this.setter=new c(this):null!=this.options.collection&&!1!==this.options.collection?this.setter=new u(this):null!=this.options.composed&&!1!==this.options.composed?this.setter=new h(this):this.setter=new p(this)}copyWith(t){return new this.constructor(Object.assign({},this.options,t))}get(){return this.getter.get()}invalidate(t){return this.getter.invalidate(t),this}unknown(t){return this.getter.unknown(t),this}set(t){return this.setter.set(t)}createScopeGetterSetters(){if(this.options.scope){const t=this;let e={};e[this.options.name+"Property"]={get:function(){return t}},e=this.getter.getScopeGetterSetters(e),e=this.setter.getScopeGetterSetters(e),Object.defineProperties(this.options.scope,e)}return this}destroy(){!0===this.options.destroy&&null!=this.value&&null!=this.value.destroy&&this.value.destroy(),"function"==typeof this.options.destroy&&this.callOptionFunct("destroy",this.value),this.getter.destroy(),this.value=null}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.options[t]),t.apply(this.options.scope||this,e)}}Property.defaultOptions={EventEmitterClass:i,initWatchers:!0},e.exports=Property},{"./getters/CalculatedGetter":22,"./getters/CompositeGetter":23,"./getters/InvalidatedGetter":24,"./getters/ManualGetter":25,"./getters/SimpleGetter":26,"./setters/BaseValueSetter":28,"./setters/CollectionSetter":29,"./setters/ManualSetter":30,"./setters/SimpleSetter":31,events:10}],21:[function(t,e,r){e.exports=class BaseGetter{constructor(t){this.prop=t}init(){this.calculated=!1,this.initiated=!1}get(){throw new Error("Not implemented")}output(){return"function"==typeof this.prop.options.output?this.prop.callOptionFunct("output",this.prop.value):this.prop.value}revalidated(){return this.calculated=!0,this.initiated=!0,this}unknown(t){return this.calculated&&this.invalidateNotice(t),this}invalidate(t){return this.calculated&&(this.calculated=!1,this.invalidateNotice(t)),this}invalidateNotice(t){t=t||{origin:this.prop},this.prop.events.emit("invalidated",t)}getScopeGetterSetters(t){const e=this.prop;return t[this.prop.options.name]=t[this.prop.options.name]||{},t[this.prop.options.name].get=function(){return e.get()},t[this.prop.options.name].enumerable=!0,t[this.prop.options.name].configurable=!0,t}destroy(){}}},{}],22:[function(t,e,r){const i=t("./BaseGetter");e.exports=class CalculatedGetter extends i{get(){if(!this.calculated){const t=this.prop.value,e=this.initiated;this.calcul(),e?this.prop.setter.checkChanges(this.prop.value,t)&&this.prop.setter.changed(t):this.prop.events.emit("updated",t)}return this.output()}calcul(){return this.prop.setter.setRawValue(this.prop.callOptionFunct("calcul")),this.prop.manual=!1,this.revalidated(),this.prop.value}}},{"./BaseGetter":21}],23:[function(t,e,r){const i=t("./InvalidatedGetter"),n=t("spark-collection"),s=t("../Invalidator"),o=t("spark-binding").Reference;class CompositeGetter extends i{init(){super.init(),null!=this.prop.options.default?this.baseValue=this.prop.options.default:(this.prop.setter.setRawValue(null),this.baseValue=null),this.members=new CompositeGetter.Members(this.prop.options.members),null!=this.prop.options.calcul&&this.members.unshift((t,e)=>this.prop.options.calcul.bind(this.prop.options.scope)(e)),this.members.changed=(t=>this.invalidate()),this.prop.members=this.members,"function"==typeof this.prop.options.composed?this.join=this.prop.options.composed:"string"==typeof this.prop.options.composed&&null!=CompositeGetter.joinFunctions[this.prop.options.composed]?this.join=CompositeGetter.joinFunctions[this.prop.options.composed]:!1===this.prop.options.default?this.join=CompositeGetter.joinFunctions.or:!0===this.prop.options.default?this.join=CompositeGetter.joinFunctions.and:this.join=CompositeGetter.joinFunctions.last}calcul(){return this.members.length?(this.invalidator||(this.invalidator=new s(this.prop,this.prop.options.scope)),this.invalidator.recycle((t,e)=>{this.prop.setter.setRawValue(this.members.reduce((t,e)=>{var r;return r="function"==typeof e?e(t,this.invalidator):e,this.join(t,r)},this.baseValue)),e(),t.isEmpty()?this.invalidator=null:t.bind()})):this.prop.setter.setRawValue(this.baseValue),this.revalidated(),this.prop.value}getScopeGetterSetters(t){t=super.getScopeGetterSetters(t);const e=this.members;return t[this.prop.options.name+"Members"]={get:function(){return e}},t}}CompositeGetter.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e},last:function(t,e){return e},sum:function(t,e){return t+e}},CompositeGetter.Members=class Members extends n{addProperty(t){return-1===this.findRefIndex(null,t)&&this.push(o.makeReferred(function(e,r){return r.prop(t)},{prop:t})),this}addPropertyPath(t,e){return-1===this.findRefIndex(t,e)&&this.push(o.makeReferred(function(r,i){return i.propPath(t,e)},{name:t,obj:e})),this}removeProperty(t){return this.removeRef({prop:t}),this}addValueRef(t,e){if(-1===this.findRefIndex(e)){const r=o.makeReferred(function(e,r){return t},e);r.val=t,this.push(r)}return this}setValueRef(t,e){const r=this.findRefIndex(e);if(-1===r)this.addValueRef(t,e);else if(this.get(r).val!==t){const i=o.makeReferred(function(e,r){return t},e);i.val=t,this.set(r,i)}return this}getValueRef(t){return this.findByRef(t).val}addFunctionRef(t,e){return-1===this.findRefIndex(e)&&(t=o.makeReferred(t,e),this.push(t)),this}findByRef(t){return this._array[this.findRefIndex(t)]}findRefIndex(t){return this._array.findIndex(function(e){return null!=e.ref&&e.ref.compareData(t)})}removeRef(t){var e,r;return-1!==(e=this.findRefIndex(t))&&(r=this.toArray(),this._array.splice(e,1),this.changed(r)),this}},e.exports=CompositeGetter},{"../Invalidator":18,"./InvalidatedGetter":24,"spark-binding":11,"spark-collection":15}],24:[function(t,e,r){const i=t("../Invalidator"),n=t("./CalculatedGetter");e.exports=class InvalidatedGetter extends n{get(){return this.invalidator&&this.invalidator.validateUnknowns(),super.get()}calcul(){return this.invalidator||(this.invalidator=new i(this.prop,this.prop.options.scope)),this.invalidator.recycle((t,e)=>{this.prop.setter.setRawValue(this.prop.callOptionFunct("calcul",t)),this.prop.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind()}),this.revalidated(),this.output()}invalidate(t){return this.calculated&&(this.calculated=!1,this.invalidateNotice(t),this.calculated||null==this.invalidator||this.invalidator.unbind()),this}destroy(){if(null!=this.invalidator)return this.invalidator.unbind()}}},{"../Invalidator":18,"./CalculatedGetter":22}],25:[function(t,e,r){const i=t("./BaseGetter");e.exports=class ManualGetter extends i{get(){return this.prop.setter.setRawValue(this.prop.callOptionFunct("get")),this.calculated=!0,this.initiated=!0,this.output()}}},{"./BaseGetter":21}],26:[function(t,e,r){const i=t("./BaseGetter");e.exports=class SimpleGetter extends i{get(){return this.calculated=!0,this.initiated||(this.initiated=!0,this.prop.events.emit("updated")),this.output()}}},{"./BaseGetter":21}],27:[function(t,e,r){const i=t("../watchers/PropertyWatcher");e.exports=class BaseSetter{constructor(t){this.prop=t}init(){this.setDefaultValue()}setDefaultValue(){this.setRawValue(this.ingest(this.prop.options.default))}loadInternalWatcher(){const t=this.prop.options.change;return"function"==typeof t?new i({property:this.prop,callback:t,scope:this.prop.options.scope,autoBind:!0}):null!=t&&"function"==typeof t.copyWith?t.copyWith({property:this.prop,scope:this.prop.options.scope,autoBind:!0}):void 0}set(t){throw new Error("Not implemented")}setRawValue(t){return this.prop.value=t,this.prop.value}ingest(t){return"function"==typeof this.prop.options.ingest&&(t=this.prop.callOptionFunct("ingest",t)),t}checkChanges(t,e){return t!==e}changed(t){const e={origin:this.prop};return this.prop.events.emit("updated",t,e),this.prop.events.emit("changed",t,e),this}getScopeGetterSetters(t){const e=this.prop;return t[this.prop.options.name]=t[this.prop.options.name]||{},t[this.prop.options.name].set=function(t){return e.set(t)},t}}},{"../watchers/PropertyWatcher":33}],28:[function(t,e,r){const i=t("./BaseSetter");e.exports=class BaseValueSetter extends i{set(t){return t=this.ingest(t),this.prop.getter.baseValue!==t&&(this.prop.getter.baseValue=t,this.prop.invalidate()),this}}},{"./BaseSetter":27}],29:[function(t,e,r){const i=t("./SimpleSetter"),n=t("spark-collection"),s=t("../watchers/CollectionPropertyWatcher");class CollectionSetter extends i{init(){this.options=Object.assign({},CollectionSetter.defaultOptions,"object"==typeof this.prop.options.collection?this.prop.options.collection:{}),super.init()}loadInternalWatcher(){if("function"==typeof this.prop.options.change||"function"==typeof this.prop.options.itemAdded||"function"==typeof this.prop.options.itemRemoved)return new s({property:this.prop,callback:this.prop.options.change,onAdded:this.prop.options.itemAdded,onRemoved:this.prop.options.itemRemoved,scope:this.prop.options.scope,autoBind:!0});super.loadInternalWatcher()}setRawValue(t){return this.prop.value=this.makeCollection(t),this.prop.value}makeCollection(t){t=this.valToArray(t);const e=this.prop,r=n.newSubClass(this.options,t);return r.changed=function(t){e.setter.changed(t)},r}valToArray(t){return null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChanges(t,e){var r;return"function"==typeof this.options.compare&&(r=this.options.compare),new n(t).checkChanges(e,this.options.ordered,r)}}CollectionSetter.defaultOptions={compare:!1,ordered:!0},e.exports=CollectionSetter},{"../watchers/CollectionPropertyWatcher":32,"./SimpleSetter":31,"spark-collection":15}],30:[function(t,e,r){const i=t("./BaseSetter");e.exports=class ManualSetter extends i{set(t){this.prop.callOptionFunct("set",t)}}},{"./BaseSetter":27}],31:[function(t,e,r){const i=t("./BaseSetter");e.exports=class SimpleSetter extends i{set(t){var e;return t=this.ingest(t),this.prop.getter.revalidated(),this.checkChanges(t,this.prop.value)&&(e=this.prop.value,this.setRawValue(t),this.prop.manual=!0,this.changed(e)),this}}},{"./BaseSetter":27}],32:[function(t,e,r){const i=t("./PropertyWatcher");e.exports=class CollectionPropertyWatcher extends i{loadOptions(t){super.loadOptions(t),this.onAdded=t.onAdded,this.onRemoved=t.onRemoved}handleChange(t,e){if(e=t.copy(e||[]),"function"==typeof this.callback&&this.callback.call(this.scope,t,e),"function"==typeof this.onAdded&&t.forEach((t,r)=>{if(!e.includes(t))return this.onAdded.call(this.scope,t)}),"function"==typeof this.onRemoved)return e.forEach((e,r)=>{if(!t.includes(e))return this.onRemoved.call(this.scope,e)})}}},{"./PropertyWatcher":33}],33:[function(t,e,r){const i=t("spark-binding").Binder,n=t("spark-binding").Reference;e.exports=class PropertyWatcher extends i{constructor(t){super(),this.options=t,this.invalidateCallback=(t=>{this.validContext(t)&&this.invalidate()}),this.updateCallback=((t,e)=>{this.validContext(e)&&this.update(t)}),null!=this.options&&this.loadOptions(this.options),this.init()}loadOptions(t){return this.scope=t.scope,this.property=t.property,this.callback=t.callback,this.autoBind=t.autoBind,this}copyWith(t){return new this.constructor(Object.assign({},this.options,t))}init(){if(this.autoBind)return this.checkBind()}getProperty(){return"string"==typeof this.property?this.getPropByName(this.property):this.property}getPropByName(t,e=this.scope){if(null!=e.propertiesManager)return e.propertiesManager.getProperty(t);if(null!=e[t+"Property"])return e[t+"Property"];throw new Error(`Could not find the property ${t}`)}checkBind(){return this.toggleBind(this.shouldBind())}shouldBind(){return!0}canBind(){return null!=this.getProperty()}doBind(){return this.update(),this.getProperty().events.on("invalidated",this.invalidateCallback),this.getProperty().events.on("updated",this.updateCallback)}doUnbind(){return this.getProperty().events.off("invalidated",this.invalidateCallback),this.getProperty().events.off("updated",this.updateCallback)}equals(t){return t.constructor===this.constructor&&null!=t&&t.event===this.event&&t.getProperty()===this.getProperty()&&n.compareVal(t.callback,this.callback)}validContext(t){return null==t||!t.preventImmediate}invalidate(){return this.getProperty().get()}update(t){var e;return e=this.getProperty().get(),this.handleChange(e,t)}handleChange(t,e){return this.callback.call(this.scope,t,e)}}},{"spark-binding":11}]},{},[9])(9)});