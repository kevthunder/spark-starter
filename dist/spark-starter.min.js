(function(){var t,e,n=[].indexOf;t="undefined"!=typeof module&&null!==module?module.exports={}:(null==this.Spark&&(this.Spark={}),this.Spark),e=function(){return class t{constructor(t,e){this.property=t,this.obj=e,this.init()}init(){return this.value=this.ingest(this.default),this.calculated=!1}get(){return this.calculated=!0,this.output()}set(t){return this.setAndCheckChanges(t)}callbackSet(t){return this.callOptionFunct("set",t),this}setAndCheckChanges(t){var e;return t=this.ingest(t),this.revalidated(),this.checkChanges(t,this.value)&&(e=this.value,this.value=t,this.manual=!0,this.changed(e)),this}checkChanges(t,e){return t!==e}destroy(){}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.property.options[t]),"function"==typeof t.overrided&&e.push((...e)=>this.callOptionFunct(t.overrided,...e)),t.apply(this.obj,e)}revalidated(){return this.calculated=!0,this.initiated=!0}ingest(t){return"function"==typeof this.property.options.ingest?this.callOptionFunct("ingest",t):t}output(){return"function"==typeof this.property.options.output?this.callOptionFunct("output",this.value):this.value}changed(t){return this.callChangedFunctions(t),"function"==typeof this.obj.emitEvent&&(this.obj.emitEvent(this.updateEventName,[t]),this.obj.emitEvent(this.changeEventName,[t])),this}callChangedFunctions(t){if("function"==typeof this.property.options.change)return this.callOptionFunct("change",t)}hasChangedFunctions(){return"function"==typeof this.property.options.change}hasChangedEvents(){return"function"==typeof this.obj.getListeners&&this.obj.getListeners(this.changeEventName).length>0}static compose(e){return null==e.instanceType&&(e.instanceType=class extends t{}),"function"==typeof e.options.set?e.instanceType.prototype.set=this.prototype.callbackSet:e.instanceType.prototype.set=this.prototype.setAndCheckChanges,e.instanceType.prototype.default=e.options.default,e.instanceType.prototype.initiated=void 0!==e.options.default,this.setEventNames(e)}static setEventNames(t){return t.instanceType.prototype.changeEventName=t.options.changeEventName||t.name+"Changed",t.instanceType.prototype.updateEventName=t.options.updateEventName||t.name+"Updated",t.instanceType.prototype.invalidateEventName=t.options.invalidateEventName||t.name+"Invalidated"}static bind(t,e){var n,i;return n=e.name.charAt(0).toUpperCase()+e.name.slice(1),i={configurable:!0,get:function(){return e.getInstance(this).get()}},!1!==e.options.set&&(i.set=function(t){return e.getInstance(this).set(t)}),Object.defineProperty(t,e.name,i),t["get"+n]=function(){return e.getInstance(this).get()},!1!==e.options.set&&(t["set"+n]=function(t){return e.getInstance(this).set(t),this}),t["invalidate"+n]=function(){return e.getInstance(this).invalidate(),this}}}},t.PropertyInstance=e(),t.PropertyInstance.definition=e,function(e){t.Binder=e(),t.Binder.definition=e}(function(){return class{bind(){return this.binded||null==this.callback||null==this.target||this.doBind(),this.binded=!0}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&null!=this.callback&&null!=this.target&&this.doUnbind(),this.binded=!1}doUnbind(){throw new Error("Not implemented")}equals(t){return this.constructor.compareRefered(t,this)}static compareRefered(t,e){return t===e||null!=t&&null!=e&&t.constructor===e.constructor&&this.compareRef(t.ref,e.ref)}static compareRef(t,e){return null!=t&&null!=e&&(t===e||Array.isArray(t)&&Array.isArray(t)&&t.every((n,i)=>this.compareRefered(t[i],e[i]))||"object"==typeof t&&"object"==typeof e&&Object.keys(t).join()===Object.keys(e).join()&&Object.keys(t).every(n=>this.compareRefered(t[n],e[n])))}}}),function(e){t.EventBind=e(),t.EventBind.definition=e}(function(e={}){var n;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,class extends n{constructor(t,e,n){super(),this.event=t,this.target=e,this.callback=n,this.ref={event:this.event,target:this.target,callback:this.callback}}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return super.equals(t)&&t.event===this.event}match(t,e){return t===this.event&&e===this.target}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}}),function(e){t.Invalidator=e(),t.Invalidator.definition=e}(function(e={}){var n,i,r;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,i=e.hasOwnProperty("EventBind")?e.EventBind:t.EventBind,r=function(t,e){var n,i;return(i=t.findIndex(e))>-1?(n=t[i],t.splice(i,1),n):null},function(){class t extends n{constructor(t,e=null){super(),this.property=t,this.obj=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalidated=!1,this.invalidateCallback=(()=>(this.invalidate(),null))}invalidate(){var t;return this.invalidated=!0,"function"==typeof this.property?this.property():"function"==typeof this.callback?this.callback():null!=this.property&&"function"==typeof this.property.invalidate?this.property.invalidate():"string"==typeof this.property?(t="invalidate"+this.property.charAt(0).toUpperCase()+this.property.slice(1),"function"==typeof this.obj[t]?this.obj[t]():this.obj[this.property]=null):void 0}unknown(){return"function"==typeof this.property.unknown?this.property.unknown():this.invalidate()}addEventBind(t,e,n){return this.addBinder(new i(t,e,n))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(r(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t,e){var n;return(n=(()=>this.addUnknown(function(){return e[t]},t,e))).ref={prop:t,target:e},n}addUnknown(t,e,n){if(!this.findUnknown(e,n))return t.ref={prop:e,target:n},this.unknowns.push(t),this.unknown()}findUnknown(t,e){if(null!=t||null!=e)return this.unknowns.find(function(n){return n.ref.prop===t&&n.ref.target===e})}event(t,e=this.obj){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,n=this.obj){return this.event(e,n),t}prop(t,e=this.obj){if("string"!=typeof t)throw new Error("Property name must be a string");return this.checkEmitter(e)?(this.addEventBind(t+"Invalidated",e,this.getUnknownCallback(t,e)),this.value(e[t],t+"Updated",e)):e[t]}propInitiated(t,e=this.obj){var n;return!(n=e.getPropertyInstance(t).initiated)&&this.checkEmitter(e)&&this.event(t+"Updated",e),n}funct(e){var n,i;return n=new t(()=>this.addUnknown(()=>{var t;if(t=e(n),i!==t)return this.invalidate()},n)),i=e(n),this.invalidationEvents.push(n),i}validateUnknowns(t,e=this.obj){var n;return n=this.unknowns,this.unknowns=[],n.forEach(function(t){return t()})}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalidated=!1,this.invalidationEvents.forEach(function(t){return t.bind()})}recycle(t){var e,n;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=(()=>(this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[])),"function"==typeof t?t.length>1?t(this,e):(n=t(this),e(),n):e}checkEmitter(t){return i.checkEmitter(t,this.strict)}unbind(){return this.invalidationEvents.forEach(function(t){return t.unbind()})}}return t.strict=!0,t}.call(this)}),function(e){t.ActivableProperty=e(),t.ActivableProperty.definition=e}(function(e={}){var n,i;return n=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,i=e.hasOwnProperty("PropertyInstance")?e.PropertyInstance:t.PropertyInstance,class extends i{activableGet(){return this.get()}activableGet(){var t;return this.isActive()?(t=this.activeGet(),this.pendingChanges&&this.changed(this.pendingOld),t):void(this.initiated=!0)}isActive(){return!0}manualActive(){return this.active}callbackActive(){return(this.activeInvalidator||new n(this,this.obj)).recycle((t,e)=>(this.active=this.callOptionFunct(this.activeFunct,t),e(),this.active||t.isEmpty()?(t.unbind(),this.activeInvalidator=null):(this.invalidator=t,this.activeInvalidator=t,t.bind()))),this.active}activeChanged(t){return this.changed(t)}activableChanged(t){return this.isActive()?(this.pendingChanges=!1,this.pendingOld=void 0,this.activeChanged()):(this.pendingChanges=!0,void 0===this.pendingOld&&(this.pendingOld=t)),this}static compose(t){if(void 0!==t.options.active){if(t.instanceType.prototype.activeGet=t.instanceType.prototype.get,t.instanceType.prototype.get=this.prototype.activableGet,t.instanceType.prototype.activeChanged=t.instanceType.prototype.changed,t.instanceType.prototype.changed=this.prototype.activableChanged,"boolean"==typeof t.options.active)return t.instanceType.prototype.active=t.options.active,t.instanceType.prototype.isActive=this.prototype.manualActive;if("function"==typeof t.options.active)return t.instanceType.prototype.activeFunct=t.options.active,t.instanceType.prototype.isActive=this.prototype.callbackActive}}}}),function(e){t.DynamicProperty=e(),t.DynamicProperty.definition=e}(function(e={}){var n;return e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("PropertyInstance")?e.PropertyInstance:t.PropertyInstance,class t extends n{init(){return super.init(),this.initRevalidate()}initRevalidate(){return this.revalidateCallback=(()=>this.get())}callbackGet(){var t;return t=this.callOptionFunct("get"),this.revalidated(),t}invalidate(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice()),this}revalidate(){return super.revalidate(),this.revalidateUpdater()}revalidateUpdater(){if(null!=this.getUpdater())return this.getUpdater().unbind()}_invalidateNotice(){return this.isImmediate()?(this.get(),!1):("function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.invalidateEventName),null!=this.getUpdater()&&this.getUpdater().bind(),!0)}getUpdater(){return void 0===this.updater&&(null!=this.property.options.updater?(this.updater=this.property.options.updater,"function"==typeof this.updater.getBinder&&(this.updater=this.updater.getBinder()),"function"!=typeof this.updater.bind||"function"!=typeof this.updater.unbind?this.updater=null:this.updater.callback=this.revalidateCallback):this.updater=null),this.updater}isImmediate(){return!1!==this.property.options.immediate&&(!0===this.property.options.immediate||("function"==typeof this.property.options.immediate?this.callOptionFunct("immediate"):null==this.getUpdater()&&(this.hasChangedEvents()||this.hasChangedFunctions())))}static compose(e){if("function"!=typeof e.options.get&&"function"!=typeof e.options.calcul&&"function"!=typeof e.options.active||null==e.instanceType&&(e.instanceType=class extends t{}),"function"==typeof e.options.get)return e.instanceType.prototype.get=this.prototype.callbackGet}}}),function(e){t.CalculatedProperty=e(),t.CalculatedProperty.definition=e}(function(e={}){var n,i;return i=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,class extends n{calculatedGet(){var t,e;return this.invalidator&&this.invalidator.validateUnknowns(),this.calculated||(e=this.value,t=this.initiated,this.calcul(),this.checkChanges(this.value,e)&&(t?this.changed(e):"function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.updateEventName,[e]))),this.output()}calcul(){return this.revalidated(),this.value}callbackCalcul(){return this.value=this.callOptionFunct(this.calculFunct),this.manual=!1,this.revalidated(),this.value}invalidatedCalcul(){return this.invalidator||(this.invalidator=new i(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.callOptionFunct(this.calculFunct,t),this.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value}unknown(){return(this.calculated||!1===this.active)&&this._invalidateNotice(),this}destroyWhithoutInvalidator(){return this.destroy()}destroyInvalidator(){if(this.destroyWhithoutInvalidator(),null!=this.invalidator)return this.invalidator.unbind()}invalidateInvalidator(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice()&&null!=this.invalidator&&this.invalidator.unbind()),this}static compose(t){if("function"==typeof t.options.calcul)return t.instanceType.prototype.calculFunct=t.options.calcul,t.instanceType.prototype.get=this.prototype.calculatedGet,t.options.calcul.length>0?(t.instanceType.prototype.calcul=this.prototype.invalidatedCalcul,t.instanceType.prototype.destroyWhithoutInvalidator=t.instanceType.prototype.destroy,t.instanceType.prototype.destroy=this.prototype.destroyInvalidator,t.instanceType.prototype.invalidate=this.prototype.invalidateInvalidator,t.instanceType.prototype.unknown=this.prototype.unknown):t.instanceType.prototype.calcul=this.prototype.callbackCalcul}}}),function(e){t.Collection=e(),t.Collection.definition=e}(function(){var t;return t=function(){class t{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,n=null){return null==n&&(n=function(t,e){return t===e}),t=this.copy(t.slice()),this.count()!==t.length||(e?this.some(function(e,i){return!n(t.get(i),e)}):this.some(function(e){return!t.pluck(function(t){return n(e,t)})}))}get(t){return this._array[t]}set(t,e){var n;return this._array[t]!==e&&(n=this.toArray(),this._array[t]=e,this.changed(n)),e}add(t){if(!this._array.includes(t))return this.push(t)}remove(t){var e,n;if(-1!==(e=this._array.indexOf(t)))return n=this.toArray(),this._array.splice(e,1),this.changed(n)}pluck(t){var e,n,i;return(n=this._array.findIndex(t))>-1?(i=this.toArray(),e=this._array[n],this._array.splice(n,1),this.changed(i),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var n;return"object"==typeof t?(n=class extends(this){},Object.assign(n.prototype,t),new n(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,n){return t[n]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}return t.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],t.readListFunctions=["concat","filter","slice"],t.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],t.readFunctions.forEach(function(e){return t.prototype[e]=function(...t){return this._array[e](...t)}}),t.readListFunctions.forEach(function(e){return t.prototype[e]=function(...t){return this.copy(this._array[e](...t))}}),t.writefunctions.forEach(function(e){return t.prototype[e]=function(...t){var n,i;return n=this.toArray(),i=this._array[e](...t),this.changed(n),i}}),t}.call(this),Object.defineProperty(t.prototype,"length",{get:function(){return this.count()}}),("undefined"!=typeof Symbol&&null!==Symbol?Symbol.iterator:void 0)&&(t.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()}),t}),function(e){t.CollectionProperty=e(),t.CollectionProperty.definition=e}(function(e={}){var n,i;return i=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,n=e.hasOwnProperty("Collection")?e.Collection:t.Collection,function(){class t extends i{ingest(t){return"function"==typeof this.property.options.ingest&&(t=this.callOptionFunct("ingest",t)),null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChangedItems(t,e){var i;return"function"==typeof this.collectionOptions.compare&&(i=this.collectionOptions.compare),new n(t).checkChanges(e,this.collectionOptions.ordered,i)}output(){var t,e,i;return i=this.value,"function"==typeof this.property.options.output&&(i=this.callOptionFunct("output",this.value)),e=this,(t=n.newSubClass(this.collectionOptions,i)).changed=function(t){return e.changed(t)},t}callChangedFunctions(t){return"function"==typeof this.property.options.itemAdded&&this.value.forEach((e,n)=>{if(!t.includes(e))return this.callOptionFunct("itemAdded",e,n)}),"function"==typeof this.property.options.itemRemoved&&t.forEach((t,e)=>{if(!this.value.includes(t))return this.callOptionFunct("itemRemoved",t,e)}),super.callChangedFunctions(t)}hasChangedFunctions(){return super.hasChangedFunctions()||"function"==typeof this.property.options.itemAdded||"function"==typeof this.property.options.itemRemoved}static compose(e){if(null!=e.options.collection&&(e.instanceType=class extends t{},e.instanceType.prototype.collectionOptions=Object.assign({},this.defaultCollectionOptions,"object"==typeof e.options.collection?e.options.collection:{}),null!=e.options.collection.compare))return e.instanceType.prototype.checkChanges=this.prototype.checkChangedItems}}return t.defaultCollectionOptions={compare:!1,ordered:!0},t}.call(this)}),function(e){t.ComposedProperty=e(),t.ComposedProperty.definition=e}(function(e={}){var n,i,r,s;return n=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t.CalculatedProperty,s=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,i=e.hasOwnProperty("Collection")?e.Collection:t.Collection,(r=function(){class t extends n{init(){return super.init(),this.initComposed()}initComposed(){return this.property.options.hasOwnProperty("default")?this.default=this.property.options.default:this.default=this.value=!0,this.members=new t.Members(this.property.options.members),this.members.changed=(t=>this.invalidate()),this.join="function"==typeof this.property.options.composed?this.property.options.composed:!1===this.property.options.default?t.joinFunctions.or:t.joinFunctions.and}calcul(){return this.invalidator||(this.invalidator=new s(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.members.reduce((t,e)=>{var n;return n="function"==typeof e?e(this.invalidator):e,this.join(t,n)},this.default),e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value}static compose(e){if(null!=e.options.composed)return e.instanceType=class extends t{},e.instanceType.prototype.get=this.prototype.calculatedGet}static bind(t,e){return n.bind(t,e),Object.defineProperty(t,e.name+"Members",{configurable:!0,get:function(){return e.getInstance(this).members}})}}return t.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e}},t}.call(this)).Members=class extends i{addPropertyRef(t,e){var n;if(-1===this.findRefIndex(t,e))return(n=function(n){return n.prop(t,e)}).ref={name:t,obj:e},this.push(n)}addValueRef(t,e,n){var i;if(-1===this.findRefIndex(e,n))return(i=function(e){return t}).ref={name:e,obj:n,val:t},this.push(i)}setValueRef(t,e,n){var i,r;return-1===(r=this.findRefIndex(e,n))?this.addValueRef(t,e,n):this.get(r).ref.val!==t?((i=function(e){return t}).ref={name:e,obj:n,val:t},this.set(r,i)):void 0}getValueRef(t,e){return this.findByRef(t,e).ref.val}addFunctionRef(t,e,n){if(-1===this.findRefIndex(e,n))return t.ref={name:e,obj:n},this.push(t)}findByRef(t,e){return this._array[this.findRefIndex(t,e)]}findRefIndex(t,e){return this._array.findIndex(function(n){return null!=n.ref&&n.ref.obj===e&&n.ref.name===t})}removeRef(t,e){var n,i;if(-1!==(n=this.findRefIndex(t,e)))return i=this.toArray(),this._array.splice(n,1),this.changed(i)}},r}),function(e){t.Mixable=e(),t.Mixable.definition=e}(function(){return function(){class t{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return t.Extension={make:function(t,e){var n,i,r,s;for(n=0,r=(s=this.getExtensionProperties(t,e)).length;n<r;n++)e[i=s[n]]=t[i];if(e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor"],getExtensionProperties:function(t,e){var i,r,s;return i=this.alwaysFinal,s=this.getPrototypeChain(e),r=[],this.getPrototypeChain(t).every(function(o){var a;if(!s.includes(o))return a=i,null!=t.getFinalProperties&&(a=a.concat(t.getFinalProperties())),"function"==typeof o&&(a=a.concat(["length","prototype","name"])),r=r.concat(Object.getOwnPropertyNames(o).filter(t=>!e.hasOwnProperty(t)&&"__"!==t.substr(0,2)&&n.call(a,t)<0)),!0}),r},getPrototypeChain:function(t){var e,n;for(n=[],e=Object.getPrototypeOf(Object);n.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return n}},t}.call(this)}),function(e){t.PropertyOwner=e(),t.PropertyOwner.definition=e}(function(){return class{getProperty(t){return this._properties&&this._properties.find(function(e){return e.name===t})}getPropertyInstance(t){var e;if(e=this.getProperty(t))return e.getInstance(this)}getProperties(){return this._properties.slice()}getPropertyInstances(){return this._properties.map(t=>t.getInstance(this))}getInstantiatedProperties(){return this._properties.filter(t=>t.isInstantiated(this)).map(t=>t.getInstance(this))}getManualDataProperties(){return this._properties.reduce((t,e)=>{var n;return e.isInstantiated(this)&&(n=e.getInstance(this)).calculated&&n.manual&&(t[e.name]=n.value),t},{})}setProperties(t,e={}){var n,i,r;for(n in t)r=t[n],null!=e.whitelist&&-1===e.whitelist.indexOf(n)||null!=e.blacklist&&-1!==e.blacklist.indexOf(n)||null!=(i=this.getPropertyInstance(n))&&i.set(r);return this}destroyProperties(){return this.getInstantiatedProperties().forEach(t=>t.destroy()),this._properties=[],!0}listenerAdded(t,e){return this._properties.forEach(e=>{if(e.getInstanceType().prototype.changeEventName===t)return e.getInstance(this).get()})}extended(t){return t.listenerAdded=this.listenerAdded}}}),function(e){t.Property=e(),t.Property.definition=e}(function(e={}){var n,i,r,s,o,a,c,h;return c=e.hasOwnProperty("PropertyInstance")?e.PropertyInstance:t.PropertyInstance,r=e.hasOwnProperty("CollectionProperty")?e.CollectionProperty:t.CollectionProperty,s=e.hasOwnProperty("ComposedProperty")?e.ComposedProperty:t.ComposedProperty,o=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,i=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t.CalculatedProperty,n=e.hasOwnProperty("ActivableProperty")?e.ActivableProperty:t.ActivableProperty,h=e.hasOwnProperty("PropertyOwner")?e.PropertyOwner:t.PropertyOwner,a=e.hasOwnProperty("Mixable")?e.Mixable:t.Mixable,function(){class t{constructor(t,e={}){this.name=t,this.options=e}bind(t){var e;return this,"function"==typeof t.getProperty&&t.getProperty(this.name)===this||("function"==typeof t.getProperty&&null!=(e=t.getProperty(this.name))&&this.override(e),this.getInstanceType().bind(t,this),t._properties=(t._properties||[]).concat([this]),null!=e&&(t._properties=t._properties.filter(function(t){return t!==e})),this.makeOwner(t)),this}override(t){var e,n,i,r;if(null==this.options.parent){for(e in this.options.parent=t.options,i=[],n=t.options)r=n[e],"function"==typeof this.options[e]&&"function"==typeof r?i.push(this.options[e].overrided=r):void 0===this.options[e]?i.push(this.options[e]=r):i.push(void 0);return i}}makeOwner(t){var e;if(!(null!=(e=t.extensions)?e.includes(h.prototype):void 0))return a.Extension.make(h.prototype,t)}getInstanceVarName(){return this.options.instanceVarName||"_"+this.name}isInstantiated(t){return null!=t[this.getInstanceVarName()]}getInstance(t){var e,n;return n=this.getInstanceVarName(),this.isInstantiated(t)||(e=this.getInstanceType(),t[n]=new e(this,t)),t[n]}getInstanceType(){return this.instanceType||this.composers.forEach(t=>t.compose(this)),this.instanceType}}return t.prototype.composers=[s,r,o,c,i,n],t}.call(this)}),function(e){t.Element=e(),t.Element.definition=e}(function(e={}){var n,i;return i=e.hasOwnProperty("Property")?e.Property:t.Property,n=e.hasOwnProperty("Mixable")?e.Mixable:t.Mixable,class extends n{tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null!=this._callbacks[t]?this._callbacks[t]:this._callbacks[t]=((...e)=>(this[t].apply(this,e),null))}getFinalProperties(){return null!=this._properties?["_properties"].concat(this._properties.map(function(t){return t.name})):[]}extended(t){var e,n,r,s,o,a;if(null!=this._properties){for(a=[],e=0,n=(o=this._properties).length;e<n;e++)s=o[e],r=Object.assign({},s.options),a.push(new i(s.name,r).bind(t));return a}}static property(t,e){return new i(t,e).bind(this.prototype)}static properties(t){var e,n,i;for(n in i=[],t)e=t[n],i.push(this.property(n,e));return i}}}),function(e){t.EventEmitter=e(),t.EventEmitter.definition=e}(function(){return function(){class t{getAllEvents(){return this._events||(this._events={})}getListeners(t){var e;return(e=this.getAllEvents())[t]||(e[t]=[])}hasListener(t,e){return this.getListeners(t).includes(e)}addListener(t,e){if(!this.hasListener(t,e))return this.getListeners(t).push(e),this.listenerAdded(t,e)}listenerAdded(t,e){}removeListener(t,e){var n,i;if(-1!==(n=(i=this.getListeners(t)).indexOf(e)))return i.splice(n,1),this.listenerRemoved(t,e)}listenerRemoved(t,e){}emitEvent(t,...e){return this.getListeners(t).forEach(function(t){return t(...e)})}}return t.prototype.emit=t.prototype.emitEvent,t.prototype.trigger=t.prototype.emitEvent,t.prototype.on=t.prototype.addListener,t.prototype.off=t.prototype.removeListener,t}.call(this)}),function(e){t.Updater=e(),t.Updater.definition=e}(function(e={}){var n,i;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,(i=class t{constructor(){this.callbacks=[],this.next=[],this.updating=!1}update(){for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)this.callbacks.shift()();return this.callbacks=this.next,this.updating=!1,this}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new t.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}}).Binder=function(t){return class extends t{constructor(t,e){super(),this.target=t,this.callback=e,this.ref={target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,n),i})}).call(this);