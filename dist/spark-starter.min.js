(function(){var t,e,n=[].indexOf;t="undefined"!=typeof module&&null!==module?module.exports={}:(null==this.Spark&&(this.Spark={}),this.Spark),e=function(){return function(){class Referred{compareRefered(t){return this.constructor.compareRefered(t,this)}getRef(){}static compareRefered(t,e){return t===e||null!=t&&null!=e&&t.constructor===e.constructor&&this.compareRef(t.ref,e.ref)}static compareRef(t,e){return null!=t&&null!=e&&(t===e||Array.isArray(t)&&Array.isArray(t)&&t.every((n,r)=>this.compareRefered(t[r],e[r]))||"object"==typeof t&&"object"==typeof e&&Object.keys(t).join()===Object.keys(e).join()&&Object.keys(t).every(n=>this.compareRefered(t[n],e[n])))}}return Object.defineProperty(Referred.prototype,"ref",{get:function(){return this.getRef()}}),Referred}.call(this)},t.Referred=e(),t.Referred.definition=e,function(e){t.Binder=e(),t.Binder.definition=e}(function(e={}){var n;return n=e.hasOwnProperty("Referred")?e.Referred:t.Referred,class Binder extends n{toggleBind(t=!this.binded){return t?this.bind():this.unbind()}bind(){return!this.binded&&this.canBind()&&this.doBind(),this.binded=!0}canBind(){return null!=this.callback&&null!=this.target}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&this.canBind()&&this.doUnbind(),this.binded=!1}doUnbind(){throw new Error("Not implemented")}equals(t){return this.compareRefered(t)}destroy(){return this.unbind()}}}),function(e){t.Collection=e(),t.Collection.definition=e}(function(){var t;return t=function(){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,n=null){return null==n&&(n=function(t,e){return t===e}),t=null!=t?this.copy(t.slice()):[],this.count()!==t.length||(e?this.some(function(e,r){return!n(t.get(r),e)}):this.some(function(e){return!t.pluck(function(t){return n(e,t)})}))}get(t){return this._array[t]}getRandom(){return this._array[Math.floor(Math.random()*this._array.length)]}set(t,e){var n;return this._array[t]!==e&&(n=this.toArray(),this._array[t]=e,this.changed(n)),e}add(t){if(!this._array.includes(t))return this.push(t)}remove(t){var e,n;if(-1!==(e=this._array.indexOf(t)))return n=this.toArray(),this._array.splice(e,1),this.changed(n)}pluck(t){var e,n,r;return(n=this._array.findIndex(t))>-1?(r=this.toArray(),e=this._array[n],this._array.splice(n,1),this.changed(r),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var n;return"object"==typeof t?(n=class extends(this){},Object.assign(n.prototype,t),new n(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,n){return t[n]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}return Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["concat","filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){return Collection.prototype[t]=function(...e){var n,r;return n=this.toArray(),r=this._array[t](...e),this.changed(n),r}}),Collection}.call(this),Object.defineProperty(t.prototype,"length",{get:function(){return this.count()}}),("undefined"!=typeof Symbol&&null!==Symbol?Symbol.iterator:void 0)&&(t.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()}),t}),function(e){t.Mixable=e(),t.Mixable.definition=e}(function(){return function(){class Mixable{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return Mixable.Extension={makeOnce:function(t,e){var n;if(!(null!=(n=e.extensions)?n.includes(t):void 0))return this.make(t,e)},make:function(t,e){var n,r,i,o,s;for(n=0,r=(s=this.getExtensionProperties(t,e)).length;n<r;n++)o=s[n],Object.defineProperty(e,o.name,o);if(t.getFinalProperties&&e.getFinalProperties?(i=e.getFinalProperties,e.getFinalProperties=function(){return t.getFinalProperties().concat(i.call(this))}):e.getFinalProperties=t.getFinalProperties||e.getFinalProperties,e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor","getFinalProperties"],getExtensionProperties:function(t,e){var r,i,o;return r=this.alwaysFinal,o=this.getPrototypeChain(e),i=[],this.getPrototypeChain(t).every(function(s){var a;if(!o.includes(s))return a=r,null!=t.getFinalProperties&&(a=a.concat(t.getFinalProperties())),"function"==typeof s&&(a=a.concat(["length","prototype","name"])),i=i.concat(Object.getOwnPropertyNames(s).filter(t=>!e.hasOwnProperty(t)&&"__"!==t.substr(0,2)&&n.call(a,t)<0&&!i.find(function(e){return e.name===t})).map(function(t){var e;return(e=Object.getOwnPropertyDescriptor(s,t)).name=t,e})),!0}),i},getPrototypeChain:function(t){var e,n;for(n=[],e=Object.getPrototypeOf(Object);n.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return n}},Mixable}.call(this)}),function(e){t.PropertyOwner=e(),t.PropertyOwner.definition=e}(function(){return class PropertyOwner{getProperty(t){return this._properties&&this._properties.find(function(e){return e.name===t})}getPropertyInstance(t){var e;if(e=this.getProperty(t))return e.getInstance(this)}getProperties(){return this._properties.slice()}getPropertyInstances(){return this._properties.map(t=>t.getInstance(this))}getInstantiatedProperties(){return this._properties.filter(t=>t.isInstantiated(this)).map(t=>t.getInstance(this))}getManualDataProperties(){return this._properties.reduce((t,e)=>{var n;return e.isInstantiated(this)&&(n=e.getInstance(this)).calculated&&n.manual&&(t[e.name]=n.value),t},{})}setProperties(t,e={}){var n,r,i;for(n in t)i=t[n],null!=e.whitelist&&-1===e.whitelist.indexOf(n)||null!=e.blacklist&&-1!==e.blacklist.indexOf(n)||null!=(r=this.getPropertyInstance(n))&&r.set(i);return this}destroyProperties(){return this.getInstantiatedProperties().forEach(t=>t.destroy()),this._properties=[],!0}listenerAdded(t,e){return this._properties.forEach(e=>{if(e.getInstanceType().prototype.changeEventName===t)return e.getInstance(this).get()})}extended(t){return t.listenerAdded=this.listenerAdded}}}),function(e){t.EventEmitter=e(),t.EventEmitter.definition=e}(function(){return function(){class EventEmitter{getAllEvents(){return this._events||(this._events={})}getListeners(t){var e;return(e=this.getAllEvents())[t]||(e[t]=[])}hasListener(t,e){return this.getListeners(t).includes(e)}addListener(t,e){if(!this.hasListener(t,e))return this.getListeners(t).push(e),this.listenerAdded(t,e)}listenerAdded(t,e){}removeListener(t,e){var n,r;if(-1!==(n=(r=this.getListeners(t)).indexOf(e)))return r.splice(n,1),this.listenerRemoved(t,e)}listenerRemoved(t,e){}emitEvent(t,...e){return this.getListeners(t).slice().forEach(function(t){return t(...e)})}}return EventEmitter.prototype.emit=EventEmitter.prototype.emitEvent,EventEmitter.prototype.trigger=EventEmitter.prototype.emitEvent,EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter}.call(this)}),function(e){t.Overrider=e(),t.Overrider.definition=e}(function(){return function(){class Overrider{static overrides(t){return this.Override.applyMany(this.prototype,this.name,t)}getFinalProperties(){return null!=this._overrides?["_overrides"].concat(Object.keys(this._overrides)):[]}extended(t){if(null!=this._overrides&&this.constructor.Override.applyMany(t,this.constructor.name,this._overrides),this.constructor===Overrider)return t.extended=this.extended}}return Overrider.Override={makeMany:function(t,e,n){var r,i,o;for(i in o=[],n)r=n[i],o.push(this.make(t,e,i,r));return o},applyMany:function(t,e,n){var r,i,o;for(r in o=[],n)"function"==typeof(i=n[r])&&(i=this.make(t,e,r,i)),o.push(this.apply(t,e,i));return o},make:function(t,e,n,r){var i;return(i={fn:{current:r},name:n}).fn["with"+e]=r,i},emptyFn:function(){},apply:function(t,e,n){var r,i,o,s,a;return r=n.name,i=null!=t._overrides?Object.assign({},t._overrides):{},a=(null!=(o=t._overrides)&&null!=(s=o[r])?s.fn.current:void 0)||t[r],n=Object.assign({},n),null!=i[r]?n.fn=Object.assign({},i[r].fn,n.fn):n.fn=Object.assign({},n.fn),n.fn["without"+e]=a||this.emptyFn,null==a?n.missingWithout="without"+e:n.missingWithout&&(n.fn[n.missingWithout]=a),Object.defineProperty(t,r,{configurable:!0,get:function(){var t,e,i,o;for(i in t=n.fn.current.bind(this),o=n.fn)e=o[i],t[i]=e.bind(this);return this.constructor.prototype!==this&&Object.defineProperty(this,r,{value:t}),t}}),i[r]=n,t._overrides=i}},Overrider}.call(this)}),function(e){t.PropertyWatcher=e(),t.PropertyWatcher.definition=e}(function(e={}){var n;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,class PropertyWatcher extends n{constructor(t){var e;super(),this.options=t,this.invalidateCallback=(()=>this.invalidate()),this.updateCallback=(t=>this.update(t)),null!=this.options&&this.loadOptions(this.options),null!=(e=this.options)&&e.initByLoader&&null!=this.options.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.property=t.property,this.callback=t.callback,this.autoBind=t.autoBind}copyWith(t){return new this.__proto__.constructor(Object.assign({},this.options,t))}init(){if(this.autoBind)return this.checkBind()}getProperty(){return"string"==typeof this.property&&(this.property=this.scope.getPropertyInstance(this.property)),this.property}checkBind(){return this.toggleBind(this.shouldBind())}shouldBind(){return!0}canBind(){return null!=this.getProperty()}doBind(){return this.update(),this.getProperty().on("invalidated",this.invalidateCallback),this.getProperty().on("updated",this.updateCallback)}doUnbind(){return this.getProperty().off("invalidated",this.invalidateCallback),this.getProperty().off("updated",this.updateCallback)}getRef(){return"string"==typeof this.property?{property:this.property,target:this.scope,callback:this.callback}:{property:this.property.property.name,target:this.property.obj,callback:this.callback}}invalidate(){return this.getProperty().get()}update(t){var e;return e=this.getProperty().get(),this.handleChange(e,t)}handleChange(t,e){return this.callback.call(this.scope,e)}}}),function(e){t.CollectionPropertyWatcher=e(),t.CollectionPropertyWatcher.definition=e}(function(e={}){var n;return n=e.hasOwnProperty("PropertyWatcher")?e.PropertyWatcher:t.PropertyWatcher,class CollectionPropertyWatcher extends n{loadOptions(t){return super.loadOptions(t),this.onAdded=t.onAdded,this.onRemoved=t.onRemoved}handleChange(t,e){if(e=t.copy(e||[]),"function"==typeof this.callback&&this.callback.call(this.scope,e),"function"==typeof this.onAdded&&t.forEach((t,n)=>{if(!e.includes(t))return this.onAdded.call(this.scope,t)}),"function"==typeof this.onRemoved)return e.forEach((e,n)=>{if(!t.includes(e))return this.onRemoved.call(this.scope,e)})}}}),function(e){t.Loader=e(),t.Loader.definition=e}(function(e={}){var n;return n=e.hasOwnProperty("Overrider")?e.Overrider:t.Overrider,function(){class Loader extends n{constructor(){super(),this.initPreloaded()}initPreloaded(){var t;return t=this.preloaded,this.preloaded=[],this.load(t)}load(t){var e,n;return n=[],e=t.map(t=>{var e;return null==t.instance&&(t=Object.assign({loader:this},t),e=Loader.load(t),(t=Object.assign({instance:e},t)).initByLoader&&null!=e.init&&n.push(e)),t}),this.preloaded=this.preloaded.concat(e),n.forEach(function(t){return t.init()})}preload(t){return Array.isArray(t)||(t=[t]),this.preloaded=this.preloaded.concat(t)}destroyLoaded(){return this.preloaded.forEach(function(t){var e;return null!=(e=t.instance)&&"function"==typeof e.destroy?e.destroy():void 0})}static loadMany(t){return t.map(t=>this.load(t))}static load(t){return"function"==typeof t.type.copyWith?t.type.copyWith(t):new t.type(t)}static preload(t){return this.prototype.preload(t)}}return Loader.prototype.preloaded=[],Loader.overrides({init:function(){return this.init.withoutLoader(),this.initPreloaded()},destroy:function(){return this.destroy.withoutLoader(),this.destroyLoaded()}}),Loader}.call(this)}),function(e){t.BasicProperty=e(),t.BasicProperty.definition=e}(function(e={}){var n,r,i,o,s;return i=e.hasOwnProperty("Mixable")?e.Mixable:t.Mixable,n=e.hasOwnProperty("EventEmitter")?e.EventEmitter:t.EventEmitter,r=e.hasOwnProperty("Loader")?e.Loader:t.Loader,o=e.hasOwnProperty("PropertyWatcher")?e.PropertyWatcher:t.PropertyWatcher,s=e.hasOwnProperty("Referred")?e.Referred:t.Referred,function(){class BasicProperty extends i{constructor(t,e){super(),this.property=t,this.obj=e}init(){var t;if(this.value=this.ingest(this.default),this.calculated=!1,this.initiated=!1,(t=this.constructor.getPreload(this.obj,this.property,this)).length>0)return r.loadMany(t)}get(){return this.calculated=!0,this.initiated||(this.initiated=!0,this.emitEvent("updated")),this.output()}set(t){return this.setAndCheckChanges(t)}callbackSet(t){return this.callOptionFunct("set",t),this}setAndCheckChanges(t){var e;return t=this.ingest(t),this.revalidated(),this.checkChanges(t,this.value)&&(e=this.value,this.value=t,this.manual=!0,this.changed(e)),this}checkChanges(t,e){return t!==e}destroy(){}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.property.options[t]),"function"==typeof t.overrided&&e.push((...e)=>this.callOptionFunct(t.overrided,...e)),t.apply(this.obj,e)}revalidated(){return this.calculated=!0,this.initiated=!0}ingest(t){return"function"==typeof this.property.options.ingest?this.callOptionFunct("ingest",t):t}output(){return"function"==typeof this.property.options.output?this.callOptionFunct("output",this.value):this.value}changed(t){return this.emitEvent("updated",t),this.emitEvent("changed",t),this}static compose(t){return null==t.instanceType&&(t.instanceType=class extends BasicProperty{}),"function"==typeof t.options.set?t.instanceType.prototype.set=this.prototype.callbackSet:t.instanceType.prototype.set=this.prototype.setAndCheckChanges,t.instanceType.prototype.default=t.options.default}static bind(t,e){var n,o,s;if(n=e.name.charAt(0).toUpperCase()+e.name.slice(1),o={configurable:!0,get:function(){return e.getInstance(this).get()}},!1!==e.options.set&&(o.set=function(t){return e.getInstance(this).set(t)}),Object.defineProperty(t,e.name,o),t["get"+n]=function(){return e.getInstance(this).get()},!1!==e.options.set&&(t["set"+n]=function(t){return e.getInstance(this).set(t),this}),t["invalidate"+n]=function(){return e.getInstance(this).invalidate(),this},(s=this.getPreload(t,e)).length>0)return i.Extension.makeOnce(r.prototype,t),t.preload(s)}static getPreload(t,e,n){var r,i,a,c;return r=[],"function"==typeof e.options.change&&(c={type:o,loaderAsScope:!0,property:n||e.name,initByLoader:!0,autoBind:!0,callback:e.options.change,ref:{prop:e.name,callback:e.options.change,context:"change"}}),"function"==typeof(null!=(i=e.options.change)?i.copyWith:void 0)&&(c={type:e.options.change,loaderAsScope:!0,property:n||e.name,initByLoader:!0,autoBind:!0,ref:{prop:e.name,type:e.options.change,context:"change"}}),null==c||(null!=(a=t.preloaded)?a.find(function(t){return s.compareRef(c.ref,t.ref)&&!n||null!=t.instance}):void 0)||r.push(c),r}}return BasicProperty.extend(n),BasicProperty}.call(this)}),function(e){t.EventBind=e(),t.EventBind.definition=e}(function(e={}){var n;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,class EventBind extends n{constructor(t,e,n){super(),this.event=t,this.target=e,this.callback=n}getRef(){return{event:this.event,target:this.target,callback:this.callback}}bindTo(t){return this.unbind(),this.target=t,this.bind()}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return super.equals(t)&&t.event===this.event}match(t,e){return t===this.event&&e===this.target}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}}),function(e){t.Invalidator=e(),t.Invalidator.definition=e}(function(e={}){var n,r,i;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,r=e.hasOwnProperty("EventBind")?e.EventBind:t.EventBind,i=function(t,e){var n,r;return(r=t.findIndex(e))>-1?(n=t[r],t.splice(r,1),n):null},function(){class Invalidator extends n{constructor(t,e=null){super(),this.invalidated=t,this.scope=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalid=!1,this.invalidateCallback=(()=>(this.invalidate(),null)),this.invalidateCallback.owner=this}invalidate(){var t;return this.invalid=!0,"function"==typeof this.invalidated?this.invalidated():"function"==typeof this.callback?this.callback():null!=this.invalidated&&"function"==typeof this.invalidated.invalidate?this.invalidated.invalidate():"string"==typeof this.invalidated?(t="invalidate"+this.invalidated.charAt(0).toUpperCase()+this.invalidated.slice(1),"function"==typeof this.scope[t]?this.scope[t]():this.scope[this.invalidated]=null):void 0}unknown(){var t;return"function"==typeof(null!=(t=this.invalidated)?t.unknown:void 0)?this.invalidated.unknown():this.invalidate()}addEventBind(t,e,n){return this.addBinder(new r(t,e,n))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(i(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t){var e;return(e=(()=>this.addUnknown(function(){return t.get()},t))).ref={prop:t},e}addUnknown(t,e){if(!this.findUnknown(e))return t.ref={prop:e},this.unknowns.push(t),this.unknown()}findUnknown(t){if(null!=t||"undefined"!=typeof target&&null!==target)return this.unknowns.find(function(e){return e.ref.prop===t})}event(t,e=this.scope){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,n=this.scope){return this.event(e,n),t}prop(t,e=this.scope){var n;if("string"==typeof t){if(null==e.getPropertyInstance||!(n=e.getPropertyInstance(t)))return e[t];t=n}else if(!this.checkPropInstance(t))throw new Error("Property must be a PropertyInstance or a string");return this.addEventBind("invalidated",t,this.getUnknownCallback(t)),this.value(t.get(),"updated",t)}propPath(t,e=this.scope){var n,r;for(t=t.split("."),r=e;null!=r&&t.length>0;)n=t.shift(),r=this.prop(n,r);return r}propInitiated(t,e=this.scope){var n;if("string"==typeof t&&null!=e.getPropertyInstance)t=e.getPropertyInstance(t);else if(!this.checkPropInstance(t))throw new Error("Property must be a PropertyInstance or a string");return(n=t.initiated)||this.event("updated",t),n}funct(t){var e,n;return e=new Invalidator(()=>this.addUnknown(()=>{var r;if(r=t(e),n!==r)return this.invalidate()},e)),n=t(e),this.invalidationEvents.push(e),n}validateUnknowns(){var t;return t=this.unknowns,this.unknowns=[],t.forEach(function(t){return t()})}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalid=!1,this.invalidationEvents.forEach(function(t){return t.bind()})}recycle(t){var e,n;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=this.endRecycle.bind(this),"function"==typeof t?t.length>1?t(this,e):(n=t(this),e(),n):e}endRecycle(){return this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[]}checkEmitter(t){return r.checkEmitter(t,this.strict)}checkPropInstance(t){return"function"==typeof t.get&&this.checkEmitter(t)}unbind(){return this.invalidationEvents.forEach(function(t){return t.unbind()})}}return Invalidator.strict=!0,Invalidator}.call(this)}),function(e){t.DynamicProperty=e(),t.DynamicProperty.definition=e}(function(e={}){var n;return e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t.BasicProperty,class DynamicProperty extends n{callbackGet(){var t;return t=this.callOptionFunct("get"),this.revalidated(),t}invalidate(){return this.calculated&&(this.calculated=!1,this._invalidateNotice()),this}_invalidateNotice(){return this.emitEvent("invalidated"),!0}static compose(t){if("function"!=typeof t.options.get&&"function"!=typeof t.options.calcul||null==t.instanceType&&(t.instanceType=class extends DynamicProperty{}),"function"==typeof t.options.get)return t.instanceType.prototype.get=this.prototype.callbackGet}}}),function(e){t.CollectionProperty=e(),t.CollectionProperty.definition=e}(function(e={}){var n,r,i,o;return i=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,n=e.hasOwnProperty("Collection")?e.Collection:t.Collection,o=e.hasOwnProperty("Referred")?e.Referred:t.Referred,r=e.hasOwnProperty("CollectionPropertyWatcher")?e.CollectionPropertyWatcher:t.CollectionPropertyWatcher,function(){class CollectionProperty extends i{ingest(t){return"function"==typeof this.property.options.ingest&&(t=this.callOptionFunct("ingest",t)),null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChangedItems(t,e){var r;return"function"==typeof this.collectionOptions.compare&&(r=this.collectionOptions.compare),new n(t).checkChanges(e,this.collectionOptions.ordered,r)}output(){var t,e,r;return r=this.value,"function"==typeof this.property.options.output&&(r=this.callOptionFunct("output",this.value)),e=this,(t=n.newSubClass(this.collectionOptions,r)).changed=function(t){return e.changed(t)},t}static compose(t){if(null!=t.options.collection&&(t.instanceType=class extends CollectionProperty{},t.instanceType.prototype.collectionOptions=Object.assign({},this.defaultCollectionOptions,"object"==typeof t.options.collection?t.options.collection:{}),null!=t.options.collection.compare))return t.instanceType.prototype.checkChanges=this.prototype.checkChangedItems}static getPreload(t,e,n){var i,s,a;return i=[],"function"!=typeof e.options.change&&"function"!=typeof e.options.itemAdded&&"function"!=typeof e.options.itemRemoved||(s={prop:e.name,context:"change"},(null!=(a=t.preloaded)?a.find(function(t){return o.compareRef(s,t.ref)&&null!=t.instance}):void 0)||i.push({type:r,loaderAsScope:!0,scope:t,property:n||e.name,initByLoader:!0,autoBind:!0,callback:e.options.change,onAdded:e.options.itemAdded,onRemoved:e.options.itemRemoved,ref:s})),i}}return CollectionProperty.defaultCollectionOptions={compare:!1,ordered:!0},CollectionProperty}.call(this)}),function(e){t.CalculatedProperty=e(),t.CalculatedProperty.definition=e}(function(e={}){var n,r;return e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,r=e.hasOwnProperty("Overrider")?e.Overrider:t.Overrider,function(){class CalculatedProperty extends n{calcul(){return this.value=this.callOptionFunct(this.calculFunct),this.manual=!1,this.revalidated(),this.value}static compose(t){if("function"==typeof t.options.calcul&&(t.instanceType.prototype.calculFunct=t.options.calcul,!(t.options.calcul.length>0)))return t.instanceType.extend(CalculatedProperty)}}return CalculatedProperty.extend(r),CalculatedProperty.overrides({get:function(){var t,e;return this.invalidator&&this.invalidator.validateUnknowns(),this.calculated||(e=this.value,t=this.initiated,this.calcul(),this.checkChanges(this.value,e)?t?this.changed(e):this.emitEvent("updated",e):t||this.emitEvent("updated",e)),this.output()}}),CalculatedProperty}.call(this)}),function(e){t.ComposedProperty=e(),t.ComposedProperty.definition=e}(function(e={}){var n,r,i,o;return n=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t.CalculatedProperty,o=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,r=e.hasOwnProperty("Collection")?e.Collection:t.Collection,(i=function(){class ComposedProperty extends n{init(){return this.initComposed(),super.init()}initComposed(){return this.property.options.hasOwnProperty("default")?this.default=this.property.options.default:this.default=this.value=!0,this.members=new ComposedProperty.Members(this.property.options.members),this.members.changed=(t=>this.invalidate()),this.join="function"==typeof this.property.options.composed?this.property.options.composed:!1===this.property.options.default?ComposedProperty.joinFunctions.or:ComposedProperty.joinFunctions.and}calcul(){return this.invalidator||(this.invalidator=new o(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.members.reduce((t,e)=>{var n;return n="function"==typeof e?e(this.invalidator):e,this.join(t,n)},this.default),e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value}static compose(t){if(null!=t.options.composed)return t.instanceType=class extends ComposedProperty{}}static bind(t,e){return n.bind(t,e),Object.defineProperty(t,e.name+"Members",{configurable:!0,get:function(){return e.getInstance(this).members}})}}return ComposedProperty.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e}},ComposedProperty}.call(this)).Members=class Members extends r{addPropertyRef(t,e){var n;if(-1===this.findRefIndex(t,e))return(n=function(n){return n.prop(t,e)}).ref={name:t,obj:e},this.push(n)}addValueRef(t,e,n){var r;if(-1===this.findRefIndex(e,n))return(r=function(e){return t}).ref={name:e,obj:n,val:t},this.push(r)}setValueRef(t,e,n){var r,i;return-1===(i=this.findRefIndex(e,n))?this.addValueRef(t,e,n):this.get(i).ref.val!==t?((r=function(e){return t}).ref={name:e,obj:n,val:t},this.set(i,r)):void 0}getValueRef(t,e){return this.findByRef(t,e).ref.val}addFunctionRef(t,e,n){if(-1===this.findRefIndex(e,n))return t.ref={name:e,obj:n},this.push(t)}findByRef(t,e){return this._array[this.findRefIndex(t,e)]}findRefIndex(t,e){return this._array.findIndex(function(n){return null!=n.ref&&n.ref.obj===e&&n.ref.name===t})}removeRef(t,e){var n,r;if(-1!==(n=this.findRefIndex(t,e)))return r=this.toArray(),this._array.splice(n,1),this.changed(r)}},i}),function(e){t.InvalidatedProperty=e(),t.InvalidatedProperty.definition=e}(function(e={}){var n,r;return r=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t.CalculatedProperty,function(){class InvalidatedProperty extends n{unknown(){return(this.calculated||!1===this.active)&&this._invalidateNotice(),this}static compose(t){if("function"==typeof t.options.calcul&&t.options.calcul.length>0)return t.instanceType.extend(InvalidatedProperty)}}return InvalidatedProperty.overrides({calcul:function(){return this.invalidator||(this.invalidator=new r(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.callOptionFunct(this.calculFunct,t),this.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value},destroy:function(){if(this.destroy.withoutInvalidatedProperty(),null!=this.invalidator)return this.invalidator.unbind()},invalidate:function(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice(),this.calculated||null==this.invalidator||this.invalidator.unbind()),this}}),InvalidatedProperty}.call(this)}),function(e){t.Property=e(),t.Property.definition=e}(function(e={}){var n,r,i,o,s,a,c,l;return n=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t.BasicProperty,i=e.hasOwnProperty("CollectionProperty")?e.CollectionProperty:t.CollectionProperty,o=e.hasOwnProperty("ComposedProperty")?e.ComposedProperty:t.ComposedProperty,s=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,r=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t.CalculatedProperty,a=e.hasOwnProperty("InvalidatedProperty")?e.InvalidatedProperty:t.InvalidatedProperty,l=e.hasOwnProperty("PropertyOwner")?e.PropertyOwner:t.PropertyOwner,c=e.hasOwnProperty("Mixable")?e.Mixable:t.Mixable,function(){class Property{constructor(t,e={}){this.name=t,this.options=e}bind(t){var e;return this,"function"==typeof t.getProperty&&t.getProperty(this.name)===this||("function"==typeof t.getProperty&&null!=(e=t.getProperty(this.name))&&this.override(e),this.getInstanceType().bind(t,this),t._properties=(t._properties||[]).concat([this]),null!=e&&(t._properties=t._properties.filter(function(t){return t!==e})),this.makeOwner(t)),this}override(t){var e,n,r,i;if(null==this.options.parent){for(e in this.options.parent=t.options,r=[],n=t.options)i=n[e],"function"==typeof this.options[e]&&"function"==typeof i?r.push(this.options[e].overrided=i):void 0===this.options[e]?r.push(this.options[e]=i):r.push(void 0);return r}}makeOwner(t){var e;if(!(null!=(e=t.extensions)?e.includes(l.prototype):void 0))return c.Extension.make(l.prototype,t)}getInstanceVarName(){return this.options.instanceVarName||"_"+this.name}isInstantiated(t){return null!=t[this.getInstanceVarName()]}getInstance(t){var e,n;return n=this.getInstanceVarName(),this.isInstantiated(t)||(e=this.getInstanceType(),t[n]=new e(this,t),t[n].init()),t[n]}getInstanceType(){return this.instanceType||this.composers.forEach(t=>t.compose(this)),this.instanceType}}return Property.prototype.composers=[o,i,s,n,r,a],Property}.call(this)}),function(e){t.Element=e(),t.Element.definition=e}(function(e={}){var n,r;return r=e.hasOwnProperty("Property")?e.Property:t.Property,n=e.hasOwnProperty("Mixable")?e.Mixable:t.Mixable,class Element extends n{constructor(){super(),this.init()}init(){}tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null==this._callbacks[t]&&(this._callbacks[t]=((...e)=>(this[t].apply(this,e),null)),this._callbacks[t].owner=this),this._callbacks[t]}getFinalProperties(){return null!=this._properties?["_properties"].concat(this._properties.map(function(t){return t.name})):[]}extended(t){var e,n,i,o,s,a;if(null!=this._properties){for(a=[],e=0,n=(s=this._properties).length;e<n;e++)o=s[e],i=Object.assign({},o.options),a.push(new r(o.name,i).bind(t));return a}}static property(t,e){return new r(t,e).bind(this.prototype)}static properties(t){var e,n,r;for(n in r=[],t)e=t[n],r.push(this.property(n,e));return r}}}),function(e){t.Updater=e(),t.Updater.definition=e}(function(e={}){var n,r;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,(r=class Updater{constructor(t){var e;this.callbacks=[],this.next=[],this.updating=!1,null!=(null!=t?t.callback:void 0)&&this.addCallback(t.callback),null!=(null!=t&&null!=(e=t.callbacks)?e.forEach:void 0)&&t.callbacks.forEach(t=>this.addCallback(t))}update(){var t;for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)t=this.callbacks.shift(),this.runCallback(t);return this.callbacks=this.next,this.updating=!1,this}runCallback(t){return t()}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new Updater.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}}).Binder=function(t){return class Binder extends t{constructor(t,e){super(),this.target=t,this.callback=e}getRef(){return{target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,n),r}),function(e){t.ActivablePropertyWatcher=e(),t.ActivablePropertyWatcher.definition=e}(function(e={}){var n,r;return r=e.hasOwnProperty("PropertyWatcher")?e.PropertyWatcher:t.PropertyWatcher,n=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,class ActivablePropertyWatcher extends r{loadOptions(t){return super.loadOptions(t),this.active=t.active}shouldBind(){var t;return null==this.active||(null==this.invalidator&&(this.invalidator=new n(this,this.scope),this.invalidator.callback=(()=>this.checkBind())),this.invalidator.recycle(),t=this.active(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),t)}}}),function(e){t.Invalidated=e(),t.Invalidated.definition=e}(function(e={}){var n;return n=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,class Invalidated{constructor(t){null!=t&&this.loadOptions(t),null!=t&&t.initByLoader&&null!=t.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.callback=t.callback}init(){return this.update()}unknown(){return this.invalidator.validateUnknowns()}invalidate(){return this.update()}update(){return null==this.invalidator&&(this.invalidator=new n(this,this.scope)),this.invalidator.recycle(),this.handleUpdate(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),this}handleUpdate(t){return null!=this.scope?this.callback.call(this.scope,t):this.callback(t)}destroy(){if(this.invalidator)return this.invalidator.unbind()}}})}).call(this);