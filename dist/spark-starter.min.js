(function(){var t,e,n=[].indexOf;t="undefined"!=typeof module&&null!==module?module.exports={}:(null==this.Spark&&(this.Spark={}),this.Spark),e=function(){return function(){class Binder{bind(){return this.binded||null==this.callback||null==this.target||this.doBind(),this.binded=!0}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&null!=this.callback&&null!=this.target&&this.doUnbind(),this.binded=!1}doUnbind(){throw new Error("Not implemented")}equals(t){return this.constructor.compareRefered(t,this)}getRef(){}static compareRefered(t,e){return t===e||null!=t&&null!=e&&t.constructor===e.constructor&&this.compareRef(t.ref,e.ref)}static compareRef(t,e){return null!=t&&null!=e&&(t===e||Array.isArray(t)&&Array.isArray(t)&&t.every((n,i)=>this.compareRefered(t[i],e[i]))||"object"==typeof t&&"object"==typeof e&&Object.keys(t).join()===Object.keys(e).join()&&Object.keys(t).every(n=>this.compareRefered(t[n],e[n])))}}return Object.defineProperty(Binder.prototype,"ref",{get:function(){return this.getRef()}}),Binder}.call(this)},t.Binder=e(),t.Binder.definition=e,function(e){t.Collection=e(),t.Collection.definition=e}(function(){var t;return t=function(){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,n=null){return null==n&&(n=function(t,e){return t===e}),t=this.copy(t.slice()),this.count()!==t.length||(e?this.some(function(e,i){return!n(t.get(i),e)}):this.some(function(e){return!t.pluck(function(t){return n(e,t)})}))}get(t){return this._array[t]}set(t,e){var n;return this._array[t]!==e&&(n=this.toArray(),this._array[t]=e,this.changed(n)),e}add(t){if(!this._array.includes(t))return this.push(t)}remove(t){var e,n;if(-1!==(e=this._array.indexOf(t)))return n=this.toArray(),this._array.splice(e,1),this.changed(n)}pluck(t){var e,n,i;return(n=this._array.findIndex(t))>-1?(i=this.toArray(),e=this._array[n],this._array.splice(n,1),this.changed(i),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var n;return"object"==typeof t?(n=class extends(this){},Object.assign(n.prototype,t),new n(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,n){return t[n]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}return Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["concat","filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){return Collection.prototype[t]=function(...e){var n,i;return n=this.toArray(),i=this._array[t](...e),this.changed(n),i}}),Collection}.call(this),Object.defineProperty(t.prototype,"length",{get:function(){return this.count()}}),("undefined"!=typeof Symbol&&null!==Symbol?Symbol.iterator:void 0)&&(t.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()}),t}),function(e){t.Mixable=e(),t.Mixable.definition=e}(function(){return function(){class Mixable{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return Mixable.Extension={make:function(t,e){var n,i,r,o;for(n=0,i=(o=this.getExtensionProperties(t,e)).length;n<i;n++)r=o[n],Object.defineProperty(e,r.name,r);if(e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor"],getExtensionProperties:function(t,e){var i,r,o;return i=this.alwaysFinal,o=this.getPrototypeChain(e),r=[],this.getPrototypeChain(t).every(function(s){var a;if(!o.includes(s))return a=i,null!=t.getFinalProperties&&(a=a.concat(t.getFinalProperties())),"function"==typeof s&&(a=a.concat(["length","prototype","name"])),r=r.concat(Object.getOwnPropertyNames(s).filter(t=>!e.hasOwnProperty(t)&&"__"!==t.substr(0,2)&&n.call(a,t)<0&&!r.find(function(e){return e.name===t})).map(function(t){var e;return(e=Object.getOwnPropertyDescriptor(s,t)).name=t,e})),!0}),r},getPrototypeChain:function(t){var e,n;for(n=[],e=Object.getPrototypeOf(Object);n.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return n}},Mixable}.call(this)}),function(e){t.PropertyOwner=e(),t.PropertyOwner.definition=e}(function(){return class PropertyOwner{getProperty(t){return this._properties&&this._properties.find(function(e){return e.name===t})}getPropertyInstance(t){var e;if(e=this.getProperty(t))return e.getInstance(this)}getProperties(){return this._properties.slice()}getPropertyInstances(){return this._properties.map(t=>t.getInstance(this))}getInstantiatedProperties(){return this._properties.filter(t=>t.isInstantiated(this)).map(t=>t.getInstance(this))}getManualDataProperties(){return this._properties.reduce((t,e)=>{var n;return e.isInstantiated(this)&&(n=e.getInstance(this)).calculated&&n.manual&&(t[e.name]=n.value),t},{})}setProperties(t,e={}){var n,i,r;for(n in t)r=t[n],null!=e.whitelist&&-1===e.whitelist.indexOf(n)||null!=e.blacklist&&-1!==e.blacklist.indexOf(n)||null!=(i=this.getPropertyInstance(n))&&i.set(r);return this}destroyProperties(){return this.getInstantiatedProperties().forEach(t=>t.destroy()),this._properties=[],!0}listenerAdded(t,e){return this._properties.forEach(e=>{if(e.getInstanceType().prototype.changeEventName===t)return e.getInstance(this).get()})}extended(t){return t.listenerAdded=this.listenerAdded}}}),function(e){t.BasicProperty=e(),t.BasicProperty.definition=e}(function(e={}){var n;return n=e.hasOwnProperty("Mixable")?e.Mixable:t.Mixable,class BasicProperty extends n{constructor(t,e){super(),this.property=t,this.obj=e,this.init()}init(){return this.value=this.ingest(this.default),this.calculated=!1}get(){return this.calculated=!0,this.output()}set(t){return this.setAndCheckChanges(t)}callbackSet(t){return this.callOptionFunct("set",t),this}setAndCheckChanges(t){var e;return t=this.ingest(t),this.revalidated(),this.checkChanges(t,this.value)&&(e=this.value,this.value=t,this.manual=!0,this.changed(e)),this}checkChanges(t,e){return t!==e}destroy(){}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.property.options[t]),"function"==typeof t.overrided&&e.push((...e)=>this.callOptionFunct(t.overrided,...e)),t.apply(this.obj,e)}revalidated(){return this.calculated=!0,this.initiated=!0}ingest(t){return"function"==typeof this.property.options.ingest?this.callOptionFunct("ingest",t):t}output(){return"function"==typeof this.property.options.output?this.callOptionFunct("output",this.value):this.value}changed(t){return this.callChangedFunctions(t),"function"==typeof this.obj.emitEvent&&(this.obj.emitEvent(this.updateEventName,[t]),this.obj.emitEvent(this.changeEventName,[t])),this}callChangedFunctions(t){if("function"==typeof this.property.options.change)return this.callOptionFunct("change",t)}hasChangedFunctions(){return"function"==typeof this.property.options.change}hasChangedEvents(){return"function"==typeof this.obj.getListeners&&this.obj.getListeners(this.changeEventName).length>0}static compose(t){return null==t.instanceType&&(t.instanceType=class extends BasicProperty{}),"function"==typeof t.options.set?t.instanceType.prototype.set=this.prototype.callbackSet:t.instanceType.prototype.set=this.prototype.setAndCheckChanges,t.instanceType.prototype.default=t.options.default,t.instanceType.prototype.initiated=void 0!==t.options.default,this.setEventNames(t)}static setEventNames(t){return t.instanceType.prototype.changeEventName=t.options.changeEventName||t.name+"Changed",t.instanceType.prototype.updateEventName=t.options.updateEventName||t.name+"Updated",t.instanceType.prototype.invalidateEventName=t.options.invalidateEventName||t.name+"Invalidated"}static bind(t,e){var n,i;return n=e.name.charAt(0).toUpperCase()+e.name.slice(1),i={configurable:!0,get:function(){return e.getInstance(this).get()}},!1!==e.options.set&&(i.set=function(t){return e.getInstance(this).set(t)}),Object.defineProperty(t,e.name,i),t["get"+n]=function(){return e.getInstance(this).get()},!1!==e.options.set&&(t["set"+n]=function(t){return e.getInstance(this).set(t),this}),t["invalidate"+n]=function(){return e.getInstance(this).invalidate(),this}}}}),function(e){t.Overrider=e(),t.Overrider.definition=e}(function(){return function(){class Overrider{static overrides(t){return this.Override.applyMany(this.prototype,this.name,t)}getFinalProperties(){return null!=this._overrides?["_overrides"].concat(Object.keys(this._overrides)):[]}extended(t){if(null!=this._overrides&&this.constructor.Override.applyMany(t,this.constructor.name,this._overrides),this.constructor===Overrider)return t.extended=this.extended}}return Overrider.Override={makeMany:function(t,e,n){var i,r,o;for(r in o=[],n)i=n[r],o.push(this.make(t,e,r,i));return o},applyMany:function(t,e,n){var i,r,o;for(i in o=[],n)"function"==typeof(r=n[i])&&(r=this.make(t,e,i,r)),o.push(this.apply(t,e,r));return o},make:function(t,e,n,i){var r;return(r={fn:{current:i},name:n}).fn["with"+e]=i,r},emptyFn:function(){},apply:function(t,e,n){var i,r,o,s,a;return i=n.name,r=null!=t._overrides?Object.assign({},t._overrides):{},a=(null!=(o=t._overrides)&&null!=(s=o[i])?s.fn.current:void 0)||t[i],n=Object.assign({},n),null!=r[i]?n.fn=Object.assign({},r[i].fn,n.fn):n.fn=Object.assign({},n.fn),n.fn["without"+e]=a||this.emptyFn,null==a?n.missingWithout="without"+e:n.missingWithout&&(n.fn[n.missingWithout]=a),Object.defineProperty(t,i,{configurable:!0,get:function(){var t,e,r,o;for(r in t=n.fn.current.bind(this),o=n.fn)e=o[r],t[r]=e.bind(this);return this.constructor.prototype!==this&&Object.defineProperty(this,i,{value:t}),t}}),r[i]=n,t._overrides=r}},Overrider}.call(this)}),function(e){t.EventBind=e(),t.EventBind.definition=e}(function(e={}){var n;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,class EventBind extends n{constructor(t,e,n){super(),this.event=t,this.target=e,this.callback=n}getRef(){return{event:this.event,target:this.target,callback:this.callback}}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return super.equals(t)&&t.event===this.event}match(t,e){return t===this.event&&e===this.target}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}}),function(e){t.Invalidator=e(),t.Invalidator.definition=e}(function(e={}){var n,i,r;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,i=e.hasOwnProperty("EventBind")?e.EventBind:t.EventBind,r=function(t,e){var n,i;return(i=t.findIndex(e))>-1?(n=t[i],t.splice(i,1),n):null},function(){class Invalidator extends n{constructor(t,e=null){super(),this.property=t,this.obj=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalidated=!1,this.invalidateCallback=(()=>(this.invalidate(),null)),this.invalidateCallback.owner=this}invalidate(){var t;return this.invalidated=!0,"function"==typeof this.property?this.property():"function"==typeof this.callback?this.callback():null!=this.property&&"function"==typeof this.property.invalidate?this.property.invalidate():"string"==typeof this.property?(t="invalidate"+this.property.charAt(0).toUpperCase()+this.property.slice(1),"function"==typeof this.obj[t]?this.obj[t]():this.obj[this.property]=null):void 0}unknown(){return"function"==typeof this.property.unknown?this.property.unknown():this.invalidate()}addEventBind(t,e,n){return this.addBinder(new i(t,e,n))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(r(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t,e){var n;return(n=(()=>this.addUnknown(function(){return e[t]},t,e))).ref={prop:t,target:e},n}addUnknown(t,e,n){if(!this.findUnknown(e,n))return t.ref={prop:e,target:n},this.unknowns.push(t),this.unknown()}findUnknown(t,e){if(null!=t||null!=e)return this.unknowns.find(function(n){return n.ref.prop===t&&n.ref.target===e})}event(t,e=this.obj){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,n=this.obj){return this.event(e,n),t}prop(t,e=this.obj){if("string"!=typeof t)throw new Error("Property name must be a string");return this.checkEmitter(e)?(this.addEventBind(t+"Invalidated",e,this.getUnknownCallback(t,e)),this.value(e[t],t+"Updated",e)):e[t]}propInitiated(t,e=this.obj){var n;return!(n=e.getPropertyInstance(t).initiated)&&this.checkEmitter(e)&&this.event(t+"Updated",e),n}funct(t){var e,n;return e=new Invalidator(()=>this.addUnknown(()=>{var i;if(i=t(e),n!==i)return this.invalidate()},e)),n=t(e),this.invalidationEvents.push(e),n}validateUnknowns(t,e=this.obj){var n;return n=this.unknowns,this.unknowns=[],n.forEach(function(t){return t()})}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalidated=!1,this.invalidationEvents.forEach(function(t){return t.bind()})}recycle(t){var e,n;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=(()=>(this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[])),"function"==typeof t?t.length>1?t(this,e):(n=t(this),e(),n):e}checkEmitter(t){return i.checkEmitter(t,this.strict)}unbind(){return this.invalidationEvents.forEach(function(t){return t.unbind()})}}return Invalidator.strict=!0,Invalidator}.call(this)}),function(e){t.DynamicProperty=e(),t.DynamicProperty.definition=e}(function(e={}){var n;return e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t.BasicProperty,class DynamicProperty extends n{callbackGet(){var t;return t=this.callOptionFunct("get"),this.revalidated(),t}invalidate(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice()),this}_invalidateNotice(){return this.isImmediate()?(this.get(),!1):("function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.invalidateEventName),!0)}isImmediate(){return!1!==this.property.options.immediate&&(!0===this.property.options.immediate||("function"==typeof this.property.options.immediate?this.callOptionFunct("immediate"):this.hasChangedEvents()||this.hasChangedFunctions()))}static compose(t){if("function"!=typeof t.options.get&&"function"!=typeof t.options.calcul&&"function"!=typeof t.options.active||null==t.instanceType&&(t.instanceType=class extends DynamicProperty{}),"function"==typeof t.options.get)return t.instanceType.prototype.get=this.prototype.callbackGet}}}),function(e){t.ActivableProperty=e(),t.ActivableProperty.definition=e}(function(e={}){var n,i,r;return i=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t.BasicProperty,r=e.hasOwnProperty("Overrider")?e.Overrider:t.Overrider,function(){class ActivableProperty extends n{isActive(){return!0}manualActive(){return this.active}callbackActive(){return(this.activeInvalidator||new i(this,this.obj)).recycle((t,e)=>(this.active=this.callOptionFunct(this.activeFunct,t),e(),this.active||t.isEmpty()?(t.unbind(),this.activeInvalidator=null):(this.invalidator=t,this.activeInvalidator=t,t.bind()))),this.active}static compose(t){if(void 0!==t.options.active){if(t.instanceType.extend(ActivableProperty),"boolean"==typeof t.options.active)return t.instanceType.prototype.active=t.options.active,t.instanceType.prototype.isActive=this.prototype.manualActive;if("function"==typeof t.options.active)return t.instanceType.prototype.activeFunct=t.options.active,t.instanceType.prototype.isActive=this.prototype.callbackActive}}}return ActivableProperty.extend(r),ActivableProperty.overrides({get:function(){var t;return this.isActive()?(t=this.get.withoutActivableProperty(),this.pendingChanges&&this.changed(this.pendingOld),t):void(this.initiated=!0)},changed:function(t){return this.isActive()?(this.pendingChanges=!1,this.pendingOld=void 0,this.changed.withoutActivableProperty(t)):(this.pendingChanges=!0,void 0===this.pendingOld&&(this.pendingOld=t)),this}}),ActivableProperty}.call(this)}),function(e){t.CollectionProperty=e(),t.CollectionProperty.definition=e}(function(e={}){var n,i;return i=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,n=e.hasOwnProperty("Collection")?e.Collection:t.Collection,function(){class CollectionProperty extends i{ingest(t){return"function"==typeof this.property.options.ingest&&(t=this.callOptionFunct("ingest",t)),null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChangedItems(t,e){var i;return"function"==typeof this.collectionOptions.compare&&(i=this.collectionOptions.compare),new n(t).checkChanges(e,this.collectionOptions.ordered,i)}output(){var t,e,i;return i=this.value,"function"==typeof this.property.options.output&&(i=this.callOptionFunct("output",this.value)),e=this,(t=n.newSubClass(this.collectionOptions,i)).changed=function(t){return e.changed(t)},t}callChangedFunctions(t){return"function"==typeof this.property.options.itemAdded&&this.value.forEach((e,n)=>{if(!t.includes(e))return this.callOptionFunct("itemAdded",e,n)}),"function"==typeof this.property.options.itemRemoved&&t.forEach((t,e)=>{if(!this.value.includes(t))return this.callOptionFunct("itemRemoved",t,e)}),super.callChangedFunctions(t)}hasChangedFunctions(){return super.hasChangedFunctions()||"function"==typeof this.property.options.itemAdded||"function"==typeof this.property.options.itemRemoved}static compose(t){if(null!=t.options.collection&&(t.instanceType=class extends CollectionProperty{},t.instanceType.prototype.collectionOptions=Object.assign({},this.defaultCollectionOptions,"object"==typeof t.options.collection?t.options.collection:{}),null!=t.options.collection.compare))return t.instanceType.prototype.checkChanges=this.prototype.checkChangedItems}}return CollectionProperty.defaultCollectionOptions={compare:!1,ordered:!0},CollectionProperty}.call(this)}),function(e){t.CalculatedProperty=e(),t.CalculatedProperty.definition=e}(function(e={}){var n,i;return e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,i=e.hasOwnProperty("Overrider")?e.Overrider:t.Overrider,function(){class CalculatedProperty extends n{calcul(){return this.value=this.callOptionFunct(this.calculFunct),this.manual=!1,this.revalidated(),this.value}static compose(t){if("function"==typeof t.options.calcul&&(t.instanceType.prototype.calculFunct=t.options.calcul,!(t.options.calcul.length>0)))return t.instanceType.extend(CalculatedProperty)}}return CalculatedProperty.extend(i),CalculatedProperty.overrides({get:function(){var t,e;return this.invalidator&&this.invalidator.validateUnknowns(),this.calculated||(e=this.value,t=this.initiated,this.calcul(),this.checkChanges(this.value,e)&&(t?this.changed(e):"function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.updateEventName,[e]))),this.output()}}),CalculatedProperty}.call(this)}),function(e){t.UpdatedProperty=e(),t.UpdatedProperty.definition=e}(function(e={}){var n,i;return e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,i=e.hasOwnProperty("Overrider")?e.Overrider:t.Overrider,function(){class UpdatedProperty extends n{initRevalidate(){return this.revalidateCallback=(()=>(this.updating=!0,this.get(),this.getUpdater().unbind(),this.pendingChanges&&this.changed(this.pendingOld),this.updating=!1)),this.revalidateCallback.owner=this}getUpdater(){return void 0===this.updater&&(null!=this.property.options.updater?(this.updater=this.property.options.updater,"function"==typeof this.updater.getBinder&&(this.updater=this.updater.getBinder()),"function"!=typeof this.updater.bind||"function"!=typeof this.updater.unbind?this.updater=null:this.updater.callback=this.revalidateCallback):this.updater=null),this.updater}static compose(t){if(null!=t.options.updater)return t.instanceType.extend(UpdatedProperty)}}return UpdatedProperty.extend(i),UpdatedProperty.overrides({init:function(){return this.init.withoutUpdatedProperty(),this.initRevalidate()},_invalidateNotice:function(){var t;return(t=this._invalidateNotice.withoutUpdatedProperty())&&this.getUpdater().bind(),t},isImmediate:function(){return!1},changed:function(t){return this.updating?(this.pendingChanges=!1,this.pendingOld=void 0,this.changed.withoutUpdatedProperty(t)):(this.pendingChanges=!0,void 0===this.pendingOld&&(this.pendingOld=t),this.getUpdater().bind()),this}}),UpdatedProperty}.call(this)}),function(e){t.ComposedProperty=e(),t.ComposedProperty.definition=e}(function(e={}){var n,i,r,o;return n=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t.CalculatedProperty,o=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,i=e.hasOwnProperty("Collection")?e.Collection:t.Collection,(r=function(){class ComposedProperty extends n{init(){return super.init(),this.initComposed()}initComposed(){return this.property.options.hasOwnProperty("default")?this.default=this.property.options.default:this.default=this.value=!0,this.members=new ComposedProperty.Members(this.property.options.members),this.members.changed=(t=>this.invalidate()),this.join="function"==typeof this.property.options.composed?this.property.options.composed:!1===this.property.options.default?ComposedProperty.joinFunctions.or:ComposedProperty.joinFunctions.and}calcul(){return this.invalidator||(this.invalidator=new o(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.members.reduce((t,e)=>{var n;return n="function"==typeof e?e(this.invalidator):e,this.join(t,n)},this.default),e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value}static compose(t){if(null!=t.options.composed)return t.instanceType=class extends ComposedProperty{}}static bind(t,e){return n.bind(t,e),Object.defineProperty(t,e.name+"Members",{configurable:!0,get:function(){return e.getInstance(this).members}})}}return ComposedProperty.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e}},ComposedProperty}.call(this)).Members=class Members extends i{addPropertyRef(t,e){var n;if(-1===this.findRefIndex(t,e))return(n=function(n){return n.prop(t,e)}).ref={name:t,obj:e},this.push(n)}addValueRef(t,e,n){var i;if(-1===this.findRefIndex(e,n))return(i=function(e){return t}).ref={name:e,obj:n,val:t},this.push(i)}setValueRef(t,e,n){var i,r;return-1===(r=this.findRefIndex(e,n))?this.addValueRef(t,e,n):this.get(r).ref.val!==t?((i=function(e){return t}).ref={name:e,obj:n,val:t},this.set(r,i)):void 0}getValueRef(t,e){return this.findByRef(t,e).ref.val}addFunctionRef(t,e,n){if(-1===this.findRefIndex(e,n))return t.ref={name:e,obj:n},this.push(t)}findByRef(t,e){return this._array[this.findRefIndex(t,e)]}findRefIndex(t,e){return this._array.findIndex(function(n){return null!=n.ref&&n.ref.obj===e&&n.ref.name===t})}removeRef(t,e){var n,i;if(-1!==(n=this.findRefIndex(t,e)))return i=this.toArray(),this._array.splice(n,1),this.changed(i)}},r}),function(e){t.InvalidatedProperty=e(),t.InvalidatedProperty.definition=e}(function(e={}){var n,i;return i=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Invalidator,n=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t.CalculatedProperty,function(){class InvalidatedProperty extends n{unknown(){return(this.calculated||!1===this.active)&&this._invalidateNotice(),this}static compose(t){if("function"==typeof t.options.calcul&&t.options.calcul.length>0)return t.instanceType.extend(InvalidatedProperty)}}return InvalidatedProperty.overrides({calcul:function(){return this.invalidator||(this.invalidator=new i(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.callOptionFunct(this.calculFunct,t),this.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value},destroy:function(){if(this.destroy.withoutInvalidatedProperty(),null!=this.invalidator)return this.invalidator.unbind()},invalidate:function(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice()&&!this.calculated&&null!=this.invalidator&&this.invalidator.unbind()),this}}),InvalidatedProperty}.call(this)}),function(e){t.Property=e(),t.Property.definition=e}(function(e={}){var n,i,r,o,s,a,c,l,p,u;return i=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t.BasicProperty,o=e.hasOwnProperty("CollectionProperty")?e.CollectionProperty:t.CollectionProperty,s=e.hasOwnProperty("ComposedProperty")?e.ComposedProperty:t.ComposedProperty,a=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t.DynamicProperty,r=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t.CalculatedProperty,c=e.hasOwnProperty("InvalidatedProperty")?e.InvalidatedProperty:t.InvalidatedProperty,n=e.hasOwnProperty("ActivableProperty")?e.ActivableProperty:t.ActivableProperty,u=e.hasOwnProperty("UpdatedProperty")?e.UpdatedProperty:t.UpdatedProperty,p=e.hasOwnProperty("PropertyOwner")?e.PropertyOwner:t.PropertyOwner,l=e.hasOwnProperty("Mixable")?e.Mixable:t.Mixable,function(){class Property{constructor(t,e={}){this.name=t,this.options=e}bind(t){var e;return this,"function"==typeof t.getProperty&&t.getProperty(this.name)===this||("function"==typeof t.getProperty&&null!=(e=t.getProperty(this.name))&&this.override(e),this.getInstanceType().bind(t,this),t._properties=(t._properties||[]).concat([this]),null!=e&&(t._properties=t._properties.filter(function(t){return t!==e})),this.makeOwner(t)),this}override(t){var e,n,i,r;if(null==this.options.parent){for(e in this.options.parent=t.options,i=[],n=t.options)r=n[e],"function"==typeof this.options[e]&&"function"==typeof r?i.push(this.options[e].overrided=r):void 0===this.options[e]?i.push(this.options[e]=r):i.push(void 0);return i}}makeOwner(t){var e;if(!(null!=(e=t.extensions)?e.includes(p.prototype):void 0))return l.Extension.make(p.prototype,t)}getInstanceVarName(){return this.options.instanceVarName||"_"+this.name}isInstantiated(t){return null!=t[this.getInstanceVarName()]}getInstance(t){var e,n;return n=this.getInstanceVarName(),this.isInstantiated(t)||(e=this.getInstanceType(),t[n]=new e(this,t)),t[n]}getInstanceType(){return this.instanceType||this.composers.forEach(t=>t.compose(this)),this.instanceType}}return Property.prototype.composers=[s,o,a,i,u,r,c,n],Property}.call(this)}),function(e){t.Element=e(),t.Element.definition=e}(function(e={}){var n,i;return i=e.hasOwnProperty("Property")?e.Property:t.Property,n=e.hasOwnProperty("Mixable")?e.Mixable:t.Mixable,class Element extends n{tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null==this._callbacks[t]&&(this._callbacks[t]=((...e)=>(this[t].apply(this,e),null)),this._callbacks[t].owner=this),this._callbacks[t]}getFinalProperties(){return null!=this._properties?["_properties"].concat(this._properties.map(function(t){return t.name})):[]}extended(t){var e,n,r,o,s,a;if(null!=this._properties){for(a=[],e=0,n=(s=this._properties).length;e<n;e++)o=s[e],r=Object.assign({},o.options),a.push(new i(o.name,r).bind(t));return a}}static property(t,e){return new i(t,e).bind(this.prototype)}static properties(t){var e,n,i;for(n in i=[],t)e=t[n],i.push(this.property(n,e));return i}}}),function(e){t.EventEmitter=e(),t.EventEmitter.definition=e}(function(){return function(){class EventEmitter{getAllEvents(){return this._events||(this._events={})}getListeners(t){var e;return(e=this.getAllEvents())[t]||(e[t]=[])}hasListener(t,e){return this.getListeners(t).includes(e)}addListener(t,e){if(!this.hasListener(t,e))return this.getListeners(t).push(e),this.listenerAdded(t,e)}listenerAdded(t,e){}removeListener(t,e){var n,i;if(-1!==(n=(i=this.getListeners(t)).indexOf(e)))return i.splice(n,1),this.listenerRemoved(t,e)}listenerRemoved(t,e){}emitEvent(t,...e){return this.getListeners(t).slice().forEach(function(t){return t(...e)})}}return EventEmitter.prototype.emit=EventEmitter.prototype.emitEvent,EventEmitter.prototype.trigger=EventEmitter.prototype.emitEvent,EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter}.call(this)}),function(e){t.Updater=e(),t.Updater.definition=e}(function(e={}){var n,i;return n=e.hasOwnProperty("Binder")?e.Binder:t.Binder,(i=class Updater{constructor(){this.callbacks=[],this.next=[],this.updating=!1}update(){for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)this.callbacks.shift()();return this.callbacks=this.next,this.updating=!1,this}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new Updater.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}}).Binder=function(t){return class Binder extends t{constructor(t,e){super(),this.target=t,this.callback=e}getRef(){return{target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,n),i})}).call(this);