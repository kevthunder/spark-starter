!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Spark=t()}}(function(){return function(){return function t(e,r,n){function i(s,a){if(!r[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=r[s]={exports:{}};e[s][0].call(p.exports,function(t){return i(e[s][1][t]||t)},p,p.exports,t,e,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}}()({1:[function(t,e,r){var n;n=t("./Referred"),e.exports=class Binder extends n{toggleBind(t=!this.binded){return t?this.bind():this.unbind()}bind(){return!this.binded&&this.canBind()&&this.doBind(),this.binded=!0}canBind(){return null!=this.callback&&null!=this.target}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&this.canBind()&&this.doUnbind(),this.binded=!1}doUnbind(){throw new Error("Not implemented")}equals(t){return this.compareRefered(t)}destroy(){return this.unbind()}}},{"./Referred":22}],2:[function(t,e,r){var n;e.exports=n=function(){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,r=null){return null==r&&(r=function(t,e){return t===e}),t=null!=t?this.copy(t.slice()):[],this.count()!==t.length||(e?this.some(function(e,n){return!r(t.get(n),e)}):this.some(function(e){return!t.pluck(function(t){return r(e,t)})}))}get(t){return this._array[t]}getRandom(){return this._array[Math.floor(Math.random()*this._array.length)]}set(t,e){var r;return this._array[t]!==e&&(r=this.toArray(),this._array[t]=e,this.changed(r)),e}add(t){if(!this._array.includes(t))return this.push(t)}remove(t){var e,r;if(-1!==(e=this._array.indexOf(t)))return r=this.toArray(),this._array.splice(e,1),this.changed(r)}pluck(t){var e,r,n;return(r=this._array.findIndex(t))>-1?(n=this.toArray(),e=this._array[r],this._array.splice(r,1),this.changed(n),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var r;return"object"==typeof t?(r=class extends(this){},Object.assign(r.prototype,t),new r(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,r){return t[r]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}return Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["concat","filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){return Collection.prototype[t]=function(...e){var r,n;return r=this.toArray(),n=this._array[t](...e),this.changed(r),n}}),Collection}.call(this),Object.defineProperty(n.prototype,"length",{get:function(){return this.count()}}),("undefined"!=typeof Symbol&&null!==Symbol?Symbol.iterator:void 0)&&(n.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()})},{}],3:[function(t,e,r){var n,i;i=t("./Property"),n=t("./Mixable"),e.exports=class Element extends n{constructor(t){super(),"object"==typeof t&&null!=this.setProperties&&this.setProperties(t),this.init()}init(){}tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null==this._callbacks[t]&&(this._callbacks[t]=((...e)=>(this[t].apply(this,e),null)),this._callbacks[t].owner=this),this._callbacks[t]}getFinalProperties(){return null!=this._properties?["_properties"].concat(this._properties.map(function(t){return t.name})):[]}extended(t){var e,r,n,o,s,a;if(null!=this._properties){for(a=[],e=0,r=(s=this._properties).length;e<r;e++)o=s[e],n=Object.assign({},o.options),a.push(new i(o.name,n).bind(t));return a}}static property(t,e){return new i(t,e).bind(this.prototype)}static properties(t){var e,r,n;for(r in n=[],t)e=t[r],n.push(this.property(r,e));return n}}},{"./Mixable":12,"./Property":14}],4:[function(t,e,r){var n;n=t("./Binder"),e.exports=class EventBind extends n{constructor(t,e,r){super(),this.event=t,this.target=e,this.callback=r}getRef(){return{event:this.event,target:this.target,callback:this.callback}}bindTo(t){return this.unbind(),this.target=t,this.bind()}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return super.equals(t)&&t.event===this.event}match(t,e){return t===this.event&&e===this.target}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}},{"./Binder":1}],5:[function(t,e,r){e.exports=function(){class EventEmitter{getAllEvents(){return this._events||(this._events={})}getListeners(t){var e;return(e=this.getAllEvents())[t]||(e[t]=[])}hasListener(t,e){return this.getListeners(t).includes(e)}addListener(t,e){if(!this.hasListener(t,e))return this.getListeners(t).push(e),this.listenerAdded(t,e)}listenerAdded(t,e){}removeListener(t,e){var r,n;if(-1!==(r=(n=this.getListeners(t)).indexOf(e)))return n.splice(r,1),this.listenerRemoved(t,e)}listenerRemoved(t,e){}emitEvent(t,...e){return this.getListeners(t).slice().forEach(function(t){return t(...e)})}removeAllListeners(){return this._events={}}}return EventEmitter.prototype.emit=EventEmitter.prototype.emitEvent,EventEmitter.prototype.trigger=EventEmitter.prototype.emitEvent,EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter}.call(this)},{}],6:[function(t,e,r){var n,i;i=t("./PropertyWatcher"),n=t("../Invalidator"),e.exports=class ActivablePropertyWatcher extends i{loadOptions(t){return super.loadOptions(t),this.active=t.active}shouldBind(){var t;return null==this.active||(null==this.invalidator&&(this.invalidator=new n(this,this.scope),this.invalidator.callback=(()=>this.checkBind())),this.invalidator.recycle(),t=this.active(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),t)}}},{"../Invalidator":10,"./PropertyWatcher":9}],7:[function(t,e,r){var n;n=t("./PropertyWatcher"),e.exports=class CollectionPropertyWatcher extends n{loadOptions(t){return super.loadOptions(t),this.onAdded=t.onAdded,this.onRemoved=t.onRemoved}handleChange(t,e){if(e=t.copy(e||[]),"function"==typeof this.callback&&this.callback.call(this.scope,e),"function"==typeof this.onAdded&&t.forEach((t,r)=>{if(!e.includes(t))return this.onAdded.call(this.scope,t)}),"function"==typeof this.onRemoved)return e.forEach((e,r)=>{if(!t.includes(e))return this.onRemoved.call(this.scope,e)})}}},{"./PropertyWatcher":9}],8:[function(t,e,r){var n;n=t("../Invalidator"),e.exports=class Invalidated{constructor(t){null!=t&&this.loadOptions(t),null!=t&&t.initByLoader&&null!=t.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.callback=t.callback}init(){return this.update()}unknown(){return this.invalidator.validateUnknowns()}invalidate(){return this.update()}update(){return null==this.invalidator&&(this.invalidator=new n(this,this.scope)),this.invalidator.recycle(),this.handleUpdate(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),this}handleUpdate(t){return null!=this.scope?this.callback.call(this.scope,t):this.callback(t)}destroy(){if(this.invalidator)return this.invalidator.unbind()}}},{"../Invalidator":10}],9:[function(t,e,r){var n;n=t("../Binder"),e.exports=class PropertyWatcher extends n{constructor(t){var e;super(),this.options=t,this.invalidateCallback=(()=>this.invalidate()),this.updateCallback=(t=>this.update(t)),null!=this.options&&this.loadOptions(this.options),null!=(e=this.options)&&e.initByLoader&&null!=this.options.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.property=t.property,this.callback=t.callback,this.autoBind=t.autoBind}copyWith(t){return new this.__proto__.constructor(Object.assign({},this.options,t))}init(){if(this.autoBind)return this.checkBind()}getProperty(){return"string"==typeof this.property&&(this.property=this.scope.getPropertyInstance(this.property)),this.property}checkBind(){return this.toggleBind(this.shouldBind())}shouldBind(){return!0}canBind(){return null!=this.getProperty()}doBind(){return this.update(),this.getProperty().on("invalidated",this.invalidateCallback),this.getProperty().on("updated",this.updateCallback)}doUnbind(){return this.getProperty().off("invalidated",this.invalidateCallback),this.getProperty().off("updated",this.updateCallback)}getRef(){return"string"==typeof this.property?{property:this.property,target:this.scope,callback:this.callback}:{property:this.property.property.name,target:this.property.obj,callback:this.callback}}invalidate(){return this.getProperty().get()}update(t){var e;return e=this.getProperty().get(),this.handleChange(e,t)}handleChange(t,e){return this.callback.call(this.scope,e)}}},{"../Binder":1}],10:[function(t,e,r){var n,i,o;n=t("./Binder"),i=t("./EventBind"),o=function(t,e){var r,n;return(n=t.findIndex(e))>-1?(r=t[n],t.splice(n,1),r):null},e.exports=function(){class Invalidator extends n{constructor(t,e=null){super(),this.invalidated=t,this.scope=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalid=!1,this.invalidateCallback=(()=>(this.invalidate(),null)),this.invalidateCallback.owner=this}invalidate(){var t;return this.invalid=!0,"function"==typeof this.invalidated?this.invalidated():"function"==typeof this.callback?this.callback():null!=this.invalidated&&"function"==typeof this.invalidated.invalidate?this.invalidated.invalidate():"string"==typeof this.invalidated?(t="invalidate"+this.invalidated.charAt(0).toUpperCase()+this.invalidated.slice(1),"function"==typeof this.scope[t]?this.scope[t]():this.scope[this.invalidated]=null):void 0}unknown(){var t;return"function"==typeof(null!=(t=this.invalidated)?t.unknown:void 0)?this.invalidated.unknown():this.invalidate()}addEventBind(t,e,r){return this.addBinder(new i(t,e,r))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(o(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t){var e;return(e=(()=>this.addUnknown(function(){return t.get()},t))).ref={prop:t},e}addUnknown(t,e){if(!this.findUnknown(e))return t.ref={prop:e},this.unknowns.push(t),this.unknown()}findUnknown(t){if(null!=t||"undefined"!=typeof target&&null!==target)return this.unknowns.find(function(e){return e.ref.prop===t})}event(t,e=this.scope){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,r=this.scope){return this.event(e,r),t}prop(t,e=this.scope){var r;if("string"==typeof t){if(null==e.getPropertyInstance||!(r=e.getPropertyInstance(t)))return e[t];t=r}else if(!this.checkPropInstance(t))throw new Error("Property must be a PropertyInstance or a string");return this.addEventBind("invalidated",t,this.getUnknownCallback(t)),this.value(t.get(),"updated",t)}propPath(t,e=this.scope){var r,n;for(t=t.split("."),n=e;null!=n&&t.length>0;)r=t.shift(),n=this.prop(r,n);return n}propInitiated(t,e=this.scope){var r;if("string"==typeof t&&null!=e.getPropertyInstance)t=e.getPropertyInstance(t);else if(!this.checkPropInstance(t))throw new Error("Property must be a PropertyInstance or a string");return(r=t.initiated)||this.event("updated",t),r}funct(t){var e,r;return e=new Invalidator(()=>this.addUnknown(()=>{var n;if(n=t(e),r!==n)return this.invalidate()},e)),r=t(e),this.invalidationEvents.push(e),r}validateUnknowns(){var t;return t=this.unknowns,this.unknowns=[],t.forEach(function(t){return t()})}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalid=!1,this.invalidationEvents.forEach(function(t){return t.bind()})}recycle(t){var e,r;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=this.endRecycle.bind(this),"function"==typeof t?t.length>1?t(this,e):(r=t(this),e(),r):e}endRecycle(){return this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[]}checkEmitter(t){return i.checkEmitter(t,this.strict)}checkPropInstance(t){return"function"==typeof t.get&&this.checkEmitter(t)}unbind(){return this.invalidationEvents.forEach(function(t){return t.unbind()})}}return Invalidator.strict=!0,Invalidator}.call(this)},{"./Binder":1,"./EventBind":4}],11:[function(t,e,r){var n;n=t("./Overrider"),e.exports=function(){class Loader extends n{constructor(){super(),this.initPreloaded()}initPreloaded(){var t;return t=this.preloaded,this.preloaded=[],this.load(t)}load(t){var e,r;return r=[],e=t.map(t=>{var e;return null==t.instance&&(t=Object.assign({loader:this},t),e=Loader.load(t),(t=Object.assign({instance:e},t)).initByLoader&&null!=e.init&&r.push(e)),t}),this.preloaded=this.preloaded.concat(e),r.forEach(function(t){return t.init()})}preload(t){return Array.isArray(t)||(t=[t]),this.preloaded=(this.preloaded||[]).concat(t)}destroyLoaded(){return this.preloaded.forEach(function(t){var e;return null!=(e=t.instance)&&"function"==typeof e.destroy?e.destroy():void 0})}getFinalProperties(){return super.getFinalProperties().concat(["preloaded"])}extended(t){if(super.extended(t),this.preloaded)return t.preloaded=(t.preloaded||[]).concat(this.preloaded)}static loadMany(t){return t.map(t=>this.load(t))}static load(t){return"function"==typeof t.type.copyWith?t.type.copyWith(t):new t.type(t)}static preload(t){return this.prototype.preload(t)}}return Loader.prototype.preloaded=[],Loader.overrides({init:function(){return this.init.withoutLoader(),this.initPreloaded()},destroy:function(){return this.destroy.withoutLoader(),this.destroyLoaded()}}),Loader}.call(this)},{"./Overrider":13}],12:[function(t,e,r){var n=[].indexOf;e.exports=function(){class Mixable{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return Mixable.Extension={makeOnce:function(t,e){var r;if(!(null!=(r=e.extensions)?r.includes(t):void 0))return this.make(t,e)},make:function(t,e){var r,n,i,o,s;for(r=0,n=(s=this.getExtensionProperties(t,e)).length;r<n;r++)o=s[r],Object.defineProperty(e,o.name,o);if(t.getFinalProperties&&e.getFinalProperties?(i=e.getFinalProperties,e.getFinalProperties=function(){return t.getFinalProperties().concat(i.call(this))}):e.getFinalProperties=t.getFinalProperties||e.getFinalProperties,e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor","getFinalProperties"],getExtensionProperties:function(t,e){var r,i,o;return r=this.alwaysFinal,o=this.getPrototypeChain(e),i=[],this.getPrototypeChain(t).every(function(s){var a;if(!o.includes(s))return a=r,null!=t.getFinalProperties&&(a=a.concat(t.getFinalProperties())),"function"==typeof s&&(a=a.concat(["length","prototype","name"])),i=i.concat(Object.getOwnPropertyNames(s).filter(t=>!e.hasOwnProperty(t)&&"__"!==t.substr(0,2)&&n.call(a,t)<0&&!i.find(function(e){return e.name===t})).map(function(t){var e;return(e=Object.getOwnPropertyDescriptor(s,t)).name=t,e})),!0}),i},getPrototypeChain:function(t){var e,r;for(r=[],e=Object.getPrototypeOf(Object);r.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return r}},Mixable}.call(this)},{}],13:[function(t,e,r){e.exports=function(){class Overrider{static overrides(t){return this.Override.applyMany(this.prototype,this.name,t)}getFinalProperties(){return null!=this._overrides?["_overrides"].concat(Object.keys(this._overrides)):[]}extended(t){if(null!=this._overrides&&this.constructor.Override.applyMany(t,this.constructor.name,this._overrides),this.constructor===Overrider)return t.extended=this.extended}}return Overrider.Override={makeMany:function(t,e,r){var n,i,o;for(i in o=[],r)n=r[i],o.push(this.make(t,e,i,n));return o},applyMany:function(t,e,r){var n,i,o;for(n in o=[],r)"function"==typeof(i=r[n])&&(i=this.make(t,e,n,i)),o.push(this.apply(t,e,i));return o},make:function(t,e,r,n){var i;return(i={fn:{current:n},name:r}).fn["with"+e]=n,i},emptyFn:function(){},apply:function(t,e,r){var n,i,o,s,a;return n=r.name,i=null!=t._overrides?Object.assign({},t._overrides):{},a=(null!=(o=t._overrides)&&null!=(s=o[n])?s.fn.current:void 0)||t[n],r=Object.assign({},r),null!=i[n]?r.fn=Object.assign({},i[n].fn,r.fn):r.fn=Object.assign({},r.fn),r.fn["without"+e]=a||this.emptyFn,null==a?r.missingWithout="without"+e:r.missingWithout&&(r.fn[r.missingWithout]=a),Object.defineProperty(t,n,{configurable:!0,get:function(){var t,e,i,o;for(i in t=r.fn.current.bind(this),o=r.fn)e=o[i],t[i]=e.bind(this);return this.constructor.prototype!==this&&Object.defineProperty(this,n,{value:t}),t}}),i[n]=r,t._overrides=i}},Overrider}.call(this)},{}],14:[function(t,e,r){var n,i,o,s,a,l,c,p;n=t("./PropertyTypes/BasicProperty"),o=t("./PropertyTypes/CollectionProperty"),s=t("./PropertyTypes/ComposedProperty"),a=t("./PropertyTypes/DynamicProperty"),i=t("./PropertyTypes/CalculatedProperty"),l=t("./PropertyTypes/InvalidatedProperty"),p=t("./PropertyOwner"),c=t("./Mixable"),e.exports=function(){class Property{constructor(t,e={}){this.name=t,this.options=e}bind(t){var e;return this,"function"==typeof t.getProperty&&t.getProperty(this.name)===this||("function"==typeof t.getProperty&&null!=(e=t.getProperty(this.name))&&this.override(e),this.getInstanceType().bind(t,this),t._properties=(t._properties||[]).concat([this]),null!=e&&(t._properties=t._properties.filter(function(t){return t!==e})),this.makeOwner(t)),this}override(t){var e,r,n,i;if(null==this.options.parent){for(e in this.options.parent=t.options,n=[],r=t.options)i=r[e],"function"==typeof this.options[e]&&"function"==typeof i?n.push(this.options[e].overrided=i):void 0===this.options[e]?n.push(this.options[e]=i):n.push(void 0);return n}}makeOwner(t){var e;if(!(null!=(e=t.extensions)?e.includes(p.prototype):void 0))return c.Extension.make(p.prototype,t)}getInstanceVarName(){return this.options.instanceVarName||"_"+this.name}isInstantiated(t){return null!=t[this.getInstanceVarName()]}getInstance(t){var e,r;return r=this.getInstanceVarName(),this.isInstantiated(t)||(e=this.getInstanceType(),t[r]=new e(this,t),t[r].init()),t[r]}getInstanceType(){return this.instanceType||this.composers.forEach(t=>t.compose(this)),this.instanceType}}return Property.prototype.composers=[s,o,a,n,i,l],Property}.call(this)},{"./Mixable":12,"./PropertyOwner":15,"./PropertyTypes/BasicProperty":16,"./PropertyTypes/CalculatedProperty":17,"./PropertyTypes/CollectionProperty":18,"./PropertyTypes/ComposedProperty":19,"./PropertyTypes/DynamicProperty":20,"./PropertyTypes/InvalidatedProperty":21}],15:[function(t,e,r){e.exports=class PropertyOwner{getProperty(t){return this._properties&&this._properties.find(function(e){return e.name===t})}getPropertyInstance(t){var e;if(e=this.getProperty(t))return e.getInstance(this)}getProperties(){return this._properties.slice()}getPropertyInstances(){return this._properties.map(t=>t.getInstance(this))}getInstantiatedProperties(){return this._properties.filter(t=>t.isInstantiated(this)).map(t=>t.getInstance(this))}getManualDataProperties(){return this._properties.reduce((t,e)=>{var r;return e.isInstantiated(this)&&(r=e.getInstance(this)).calculated&&r.manual&&(t[e.name]=r.value),t},{})}setProperties(t,e={}){var r,n,i;for(r in t)i=t[r],null!=e.whitelist&&-1===e.whitelist.indexOf(r)||null!=e.blacklist&&-1!==e.blacklist.indexOf(r)||null!=(n=this.getPropertyInstance(r))&&n.set(i);return this}destroyProperties(){return this.getInstantiatedProperties().forEach(t=>t.destroy()),this._properties=[],!0}listenerAdded(t,e){return this._properties.forEach(e=>{if(e.getInstanceType().prototype.changeEventName===t)return e.getInstance(this).get()})}extended(t){return t.listenerAdded=this.listenerAdded}}},{}],16:[function(t,e,r){var n,i,o,s,a;o=t("../Mixable"),n=t("../EventEmitter"),i=t("../Loader"),s=t("../Invalidated/PropertyWatcher"),a=t("../Referred"),e.exports=function(){class BasicProperty extends o{constructor(t,e){super(),this.property=t,this.obj=e}init(){var t;if(this.value=this.ingest(this.default),this.calculated=!1,this.initiated=!1,(t=this.constructor.getPreload(this.obj,this.property,this)).length>0)return i.loadMany(t)}get(){return this.calculated=!0,this.initiated||(this.initiated=!0,this.emitEvent("updated")),this.output()}set(t){return this.setAndCheckChanges(t)}callbackSet(t){return this.callOptionFunct("set",t),this}setAndCheckChanges(t){var e;return t=this.ingest(t),this.revalidated(),this.checkChanges(t,this.value)&&(e=this.value,this.value=t,this.manual=!0,this.changed(e)),this}checkChanges(t,e){return t!==e}destroy(){var t;return!0===this.property.options.destroy&&null!=(null!=(t=this.value)?t.destroy:void 0)&&this.value.destroy(),"function"==typeof this.property.options.destroy&&this.callOptionFunct("destroy",this.value),this.value=null}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.property.options[t]),"function"==typeof t.overrided&&e.push((...e)=>this.callOptionFunct(t.overrided,...e)),t.apply(this.obj,e)}revalidated(){return this.calculated=!0,this.initiated=!0}ingest(t){return"function"==typeof this.property.options.ingest?this.callOptionFunct("ingest",t):t}output(){return"function"==typeof this.property.options.output?this.callOptionFunct("output",this.value):this.value}changed(t){return this.emitEvent("updated",t),this.emitEvent("changed",t),this}static compose(t){return null==t.instanceType&&(t.instanceType=class extends BasicProperty{}),"function"==typeof t.options.set&&(t.instanceType.prototype.set=this.prototype.callbackSet),t.instanceType.prototype.default=t.options.default}static bind(t,e){var r,n,s;if(r=e.name.charAt(0).toUpperCase()+e.name.slice(1),n={configurable:!0,get:function(){return e.getInstance(this).get()}},!1!==e.options.set&&(n.set=function(t){return e.getInstance(this).set(t)}),Object.defineProperty(t,e.name,n),t["get"+r]=function(){return e.getInstance(this).get()},!1!==e.options.set&&(t["set"+r]=function(t){return e.getInstance(this).set(t),this}),t["invalidate"+r]=function(){return e.getInstance(this).invalidate(),this},(s=this.getPreload(t,e)).length>0)return o.Extension.makeOnce(i.prototype,t),t.preload(s)}static getPreload(t,e,r){var n,i,o,l;return n=[],"function"==typeof e.options.change&&(l={type:s,loaderAsScope:!0,property:r||e.name,initByLoader:!0,autoBind:!0,callback:e.options.change,ref:{prop:e.name,callback:e.options.change,context:"change"}}),"function"==typeof(null!=(i=e.options.change)?i.copyWith:void 0)&&(l={type:e.options.change,loaderAsScope:!0,property:r||e.name,initByLoader:!0,autoBind:!0,ref:{prop:e.name,type:e.options.change,context:"change"}}),null==l||(null!=(o=t.preloaded)?o.find(function(t){return a.compareRef(l.ref,t.ref)&&!r||null!=t.instance}):void 0)||n.push(l),n}}return BasicProperty.extend(n),BasicProperty}.call(this)},{"../EventEmitter":5,"../Invalidated/PropertyWatcher":9,"../Loader":11,"../Mixable":12,"../Referred":22}],17:[function(t,e,r){var n,i;t("../Invalidator"),n=t("./DynamicProperty"),i=t("../Overrider"),e.exports=function(){class CalculatedProperty extends n{calcul(){return this.value=this.callOptionFunct(this.calculFunct),this.manual=!1,this.revalidated(),this.value}static compose(t){if("function"==typeof t.options.calcul&&null==t.options.composed&&(t.instanceType.prototype.calculFunct=t.options.calcul,!(t.options.calcul.length>0)))return t.instanceType.extend(CalculatedProperty)}}return CalculatedProperty.extend(i),CalculatedProperty.overrides({get:function(){var t,e;return this.invalidator&&this.invalidator.validateUnknowns(),this.calculated||(e=this.value,t=this.initiated,this.calcul(),this.checkChanges(this.value,e)?t?this.changed(e):this.emitEvent("updated",e):t||this.emitEvent("updated",e)),this.output()}}),CalculatedProperty}.call(this)},{"../Invalidator":10,"../Overrider":13,"./DynamicProperty":20}],18:[function(t,e,r){var n,i,o,s;o=t("./DynamicProperty"),n=t("../Collection"),s=t("../Referred"),i=t("../Invalidated/CollectionPropertyWatcher"),e.exports=function(){class CollectionProperty extends o{ingest(t){return"function"==typeof this.property.options.ingest&&(t=this.callOptionFunct("ingest",t)),null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChangedItems(t,e){var r;return"function"==typeof this.collectionOptions.compare&&(r=this.collectionOptions.compare),new n(t).checkChanges(e,this.collectionOptions.ordered,r)}output(){var t,e,r;return r=this.value,"function"==typeof this.property.options.output&&(r=this.callOptionFunct("output",this.value)),e=this,(t=n.newSubClass(this.collectionOptions,r)).changed=function(t){return e.changed(t)},t}static compose(t){if(null!=t.options.collection&&(t.instanceType=class extends CollectionProperty{},t.instanceType.prototype.collectionOptions=Object.assign({},this.defaultCollectionOptions,"object"==typeof t.options.collection?t.options.collection:{}),null!=t.options.collection.compare))return t.instanceType.prototype.checkChanges=this.prototype.checkChangedItems}static getPreload(t,e,r){var n,o,a;return n=[],"function"!=typeof e.options.change&&"function"!=typeof e.options.itemAdded&&"function"!=typeof e.options.itemRemoved||(o={prop:e.name,context:"change"},(null!=(a=t.preloaded)?a.find(function(t){return s.compareRef(o,t.ref)&&null!=t.instance}):void 0)||n.push({type:i,loaderAsScope:!0,scope:t,property:r||e.name,initByLoader:!0,autoBind:!0,callback:e.options.change,onAdded:e.options.itemAdded,onRemoved:e.options.itemRemoved,ref:o})),n}}return CollectionProperty.defaultCollectionOptions={compare:!1,ordered:!0},CollectionProperty}.call(this)},{"../Collection":2,"../Invalidated/CollectionPropertyWatcher":7,"../Referred":22,"./DynamicProperty":20}],19:[function(t,e,r){var n,i,o,s;n=t("./CalculatedProperty"),s=t("../Invalidator"),i=t("../Collection"),e.exports=o=function(){class ComposedProperty extends n{init(){return this.initComposed(),super.init()}initComposed(){return this.property.options.hasOwnProperty("default")?this.default=this.property.options.default:this.default=this.value=!0,this.members=new ComposedProperty.Members(this.property.options.members),null!=this.property.options.calcul&&this.members.unshift((t,e)=>this.property.options.calcul.bind(this.obj)(e)),this.members.changed=(t=>this.invalidate()),this.join="function"==typeof this.property.options.composed?this.property.options.composed:"string"==typeof this.property.options.composed&&null!=ComposedProperty.joinFunctions[this.property.options.composed]?ComposedProperty.joinFunctions[this.property.options.composed]:!1===this.property.options.default?ComposedProperty.joinFunctions.or:!0===this.property.options.default?ComposedProperty.joinFunctions.and:ComposedProperty.joinFunctions.last}calcul(){return this.members.length?(this.invalidator||(this.invalidator=new s(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.members.reduce((t,e)=>{var r;return r="function"==typeof e?e(t,this.invalidator):e,this.join(t,r)},this.default),e(),t.isEmpty()?this.invalidator=null:t.bind()))):this.value=this.default,this.revalidated(),this.value}set(t){if(t=this.ingest(t),this.default!==t)return this.default=t,this.invalidate()}static compose(t){if(null!=t.options.composed)return t.instanceType=class extends ComposedProperty{}}static bind(t,e){return n.bind(t,e),Object.defineProperty(t,e.name+"Members",{configurable:!0,get:function(){return e.getInstance(this).members}})}}return ComposedProperty.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e},last:function(t,e){return e},sum:function(t,e){return t+e}},ComposedProperty}.call(this),o.Members=class Members extends i{addPropertyRef(t,e){var r;if(-1===this.findRefIndex(t,e))return(r=function(r,n){return n.propPath(t,e)}).ref={name:t,obj:e},this.push(r)}addValueRef(t,e,r){var n;if(-1===this.findRefIndex(e,r))return(n=function(e,r){return t}).ref={name:e,obj:r,val:t},this.push(n)}setValueRef(t,e,r){var n,i;return-1===(i=this.findRefIndex(e,r))?this.addValueRef(t,e,r):this.get(i).ref.val!==t?((n=function(e,r){return t}).ref={name:e,obj:r,val:t},this.set(i,n)):void 0}getValueRef(t,e){return this.findByRef(t,e).ref.val}addFunctionRef(t,e,r){if(-1===this.findRefIndex(e,r))return t.ref={name:e,obj:r},this.push(t)}findByRef(t,e){return this._array[this.findRefIndex(t,e)]}findRefIndex(t,e){return this._array.findIndex(function(r){return null!=r.ref&&r.ref.obj===e&&r.ref.name===t})}removeRef(t,e){var r,n;if(-1!==(r=this.findRefIndex(t,e)))return n=this.toArray(),this._array.splice(r,1),this.changed(n)}}},{"../Collection":2,"../Invalidator":10,"./CalculatedProperty":17}],20:[function(t,e,r){var n;t("../Invalidator"),n=t("./BasicProperty"),e.exports=class DynamicProperty extends n{callbackGet(){var t;return t=this.callOptionFunct("get"),this.revalidated(),t}invalidate(){return this.calculated&&(this.calculated=!1,this._invalidateNotice()),this}_invalidateNotice(){return this.emitEvent("invalidated"),!0}static compose(t){if("function"!=typeof t.options.get&&"function"!=typeof t.options.calcul||null==t.instanceType&&(t.instanceType=class extends DynamicProperty{}),"function"==typeof t.options.get)return t.instanceType.prototype.get=this.prototype.callbackGet}}},{"../Invalidator":10,"./BasicProperty":16}],21:[function(t,e,r){var n,i;i=t("../Invalidator"),n=t("./CalculatedProperty"),e.exports=function(){class InvalidatedProperty extends n{unknown(){return(this.calculated||!1===this.active)&&this._invalidateNotice(),this}static compose(t){if("function"==typeof t.options.calcul&&t.options.calcul.length>0&&null==t.options.composed)return t.instanceType.extend(InvalidatedProperty)}}return InvalidatedProperty.overrides({calcul:function(){return this.invalidator||(this.invalidator=new i(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.callOptionFunct(this.calculFunct,t),this.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value},destroy:function(){if(this.destroy.withoutInvalidatedProperty(),null!=this.invalidator)return this.invalidator.unbind()},invalidate:function(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice(),this.calculated||null==this.invalidator||this.invalidator.unbind()),this}}),InvalidatedProperty}.call(this)},{"../Invalidator":10,"./CalculatedProperty":17}],22:[function(t,e,r){e.exports=function(){class Referred{compareRefered(t){return this.constructor.compareRefered(t,this)}getRef(){}static compareRefered(t,e){return t===e||null!=t&&null!=e&&t.constructor===e.constructor&&this.compareRef(t.ref,e.ref)}static compareRef(t,e){return null!=t&&null!=e&&(t===e||Array.isArray(t)&&Array.isArray(t)&&t.every((r,n)=>this.compareRefered(t[n],e[n]))||"object"==typeof t&&"object"==typeof e&&Object.keys(t).join()===Object.keys(e).join()&&Object.keys(t).every(r=>this.compareRefered(t[r],e[r])))}}return Object.defineProperty(Referred.prototype,"ref",{get:function(){return this.getRef()}}),Referred}.call(this)},{}],23:[function(t,e,r){var n,i;n=t("./Binder"),e.exports=i=class Updater{constructor(t){var e;this.callbacks=[],this.next=[],this.updating=!1,null!=(null!=t?t.callback:void 0)&&this.addCallback(t.callback),null!=(null!=t&&null!=(e=t.callbacks)?e.forEach:void 0)&&t.callbacks.forEach(t=>this.addCallback(t))}update(){var t;for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)t=this.callbacks.shift(),this.runCallback(t);return this.callbacks=this.next,this.updating=!1,this}runCallback(t){return t()}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new Updater.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}},i.Binder=function(t){return class Binder extends t{constructor(t,e){super(),this.target=t,this.callback=e}getRef(){return{target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,n)},{"./Binder":1}],24:[function(t,e,r){e.exports={Binder:t("./Binder"),Collection:t("./Collection"),Element:t("./Element"),EventBind:t("./EventBind"),EventEmitter:t("./EventEmitter"),Invalidator:t("./Invalidator"),Loader:t("./Loader"),Mixable:t("./Mixable"),Overrider:t("./Overrider"),Property:t("./Property"),PropertyOwner:t("./PropertyOwner"),Referred:t("./Referred"),Updater:t("./Updater"),Invalidated:{ActivablePropertyWatcher:t("./Invalidated/ActivablePropertyWatcher"),CollectionPropertyWatcher:t("./Invalidated/CollectionPropertyWatcher"),Invalidated:t("./Invalidated/Invalidated"),PropertyWatcher:t("./Invalidated/PropertyWatcher")},PropertyTypes:{BasicProperty:t("./PropertyTypes/BasicProperty"),CalculatedProperty:t("./PropertyTypes/CalculatedProperty"),CollectionProperty:t("./PropertyTypes/CollectionProperty"),ComposedProperty:t("./PropertyTypes/ComposedProperty"),DynamicProperty:t("./PropertyTypes/DynamicProperty"),InvalidatedProperty:t("./PropertyTypes/InvalidatedProperty")}}},{"./Binder":1,"./Collection":2,"./Element":3,"./EventBind":4,"./EventEmitter":5,"./Invalidated/ActivablePropertyWatcher":6,"./Invalidated/CollectionPropertyWatcher":7,"./Invalidated/Invalidated":8,"./Invalidated/PropertyWatcher":9,"./Invalidator":10,"./Loader":11,"./Mixable":12,"./Overrider":13,"./Property":14,"./PropertyOwner":15,"./PropertyTypes/BasicProperty":16,"./PropertyTypes/CalculatedProperty":17,"./PropertyTypes/CollectionProperty":18,"./PropertyTypes/ComposedProperty":19,"./PropertyTypes/DynamicProperty":20,"./PropertyTypes/InvalidatedProperty":21,"./Referred":22,"./Updater":23}]},{},[24])(24)});